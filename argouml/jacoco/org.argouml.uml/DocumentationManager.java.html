<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DocumentationManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argouml-app</a> &gt; <a href="index.source.html" class="el_package">org.argouml.uml</a> &gt; <span class="el_source">DocumentationManager.java</span></div><h1>DocumentationManager.java</h1><pre class="source lang-java linenums">/* $Id$
 *****************************************************************************
 * Copyright (c) 2009 Contributors - see below
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    tfmorris
 *****************************************************************************
 *
 * Some portions of this file was previously release using the BSD License:
 */

// Copyright (c) 1996-2007 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies.  This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied &quot;AS
// IS&quot;, without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason.  IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package org.argouml.uml;

import java.util.Collection;
import java.util.Iterator;

import org.argouml.application.api.Argo;
import org.argouml.model.Model;
import org.argouml.util.MyTokenizer;

/**
 * This class handles the Documentation of ModelElements.
 * Documentation is represented internally by the tagged value &quot;documentation&quot;,
 * but it has its own tab-panel to ease user handling.
 *
 */
<span class="nc" id="L54">public class DocumentationManager {</span>

    /**
     * The system's native line-ends, for when things are written to file.
     */
<span class="nc" id="L59">    private static final String LINE_SEPARATOR =</span>
<span class="nc" id="L60">	System.getProperty(&quot;line.separator&quot;);</span>

    /**
     * This function returns the documentation in C-style comment format.
     *
     * @param o the ModelElement
     * @param indent the current indentation for new lines
     * @return the documentation, as a String
     */
    public static String getDocs(Object o, String indent) {
<span class="nc" id="L70">        return getDocs(o, indent, &quot;/** &quot;, &quot; *  &quot;, &quot; */&quot;);</span>
    }

    /**
     * @param o the ModelElement
     * @param indent the current indentation for new lines
     * @param header is the first line
     * @param prefix is inserted at every line before the doc
     * @param footer is the closing line
     * @return the string that represents the documentation
     *         for the given ModelElement
     */
    public static String getDocs(Object o, String indent, String header,
				 String prefix, String footer) {
<span class="nc" id="L84">        String sResult = defaultFor(o, indent);</span>

<span class="nc bnc" id="L86" title="All 2 branches missed.">        if (Model.getFacade().isAModelElement(o)) {</span>
<span class="nc" id="L87">            Iterator iter = Model.getFacade().getTaggedValues(o);</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">            if (iter != null) {</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">                while (iter.hasNext()) {</span>
<span class="nc" id="L90">                    Object tv = iter.next();</span>
<span class="nc" id="L91">                    String tag = Model.getFacade().getTagOfTag(tv);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">                    if (Argo.DOCUMENTATION_TAG.equals(tag) </span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                            || Argo.DOCUMENTATION_TAG_ALT.equals(tag)) {</span>
<span class="nc" id="L94">                        sResult = Model.getFacade().getValueOfTag(tv);</span>
                        // give priority to standard documentation tag
<span class="nc bnc" id="L96" title="All 2 branches missed.">                        if (Argo.DOCUMENTATION_TAG.equals(tag)) {</span>
<span class="nc" id="L97">                            break;</span>
                        }
                    }
<span class="nc" id="L100">                }</span>
            }
        }

<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (sResult == null) {</span>
<span class="nc" id="L105">            return &quot;(No comment)&quot;;</span>
        }

<span class="nc" id="L108">	StringBuffer result = new StringBuffer();</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">	if (header != null) {</span>
<span class="nc" id="L110">	    result.append(header).append(LINE_SEPARATOR);</span>
	}

<span class="nc bnc" id="L113" title="All 2 branches missed.">	if (indent != null) {</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">	    if (prefix != null) {</span>
<span class="nc" id="L115">		prefix = indent + prefix;</span>
	    }

<span class="nc bnc" id="L118" title="All 2 branches missed.">	    if (footer != null) {</span>
<span class="nc" id="L119">		footer = indent + footer;</span>
	    }
	}

<span class="nc" id="L123">	appendComment(result, prefix, sResult, 0);</span>

<span class="nc bnc" id="L125" title="All 2 branches missed.">	if (footer != null) {</span>
<span class="nc" id="L126">	    result.append(footer);</span>
	}

<span class="nc" id="L129">        return result.toString();</span>
    }

    /**
     * @param o the ModelElement. If it is not a ModelElement,
     *          then you'll get a IllegalArgumentException
     * @param s the string representing the documentation
     */
    public static void setDocs(Object o, String s) {
        Object taggedValue =
<span class="nc" id="L139">                Model.getFacade().getTaggedValue(o, Argo.DOCUMENTATION_TAG);</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">        if (taggedValue == null) {</span>
            taggedValue =
<span class="nc" id="L142">                    Model.getExtensionMechanismsFactory().buildTaggedValue(</span>
                            Argo.DOCUMENTATION_TAG, s);
<span class="nc" id="L144">            Model.getExtensionMechanismsHelper().addTaggedValue(o, taggedValue);</span>
        } else {
<span class="nc" id="L146">            Model.getExtensionMechanismsHelper().setValueOfTag(taggedValue, s);</span>
        }
<span class="nc" id="L148">    }</span>

    /**
     * Determine whether documentation is associated with the given
     * element or not.
     *
     * Added 2001-10-05 STEFFEN ZSCHALER for use by
     * org.argouml.language.java.generator.CodeGenerator
     *
     * @param o The given element.
     * @return true if the given element has docs.
     */
    public static boolean hasDocs(Object o) {
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (Model.getFacade().isAModelElement(o)) {</span>
<span class="nc" id="L162">            Iterator i = Model.getFacade().getTaggedValues(o);</span>

<span class="nc bnc" id="L164" title="All 2 branches missed.">            if (i != null) {</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">                while (i.hasNext()) {</span>
<span class="nc" id="L166">                    Object tv = i.next();</span>
<span class="nc" id="L167">                    String tag = Model.getFacade().getTagOfTag(tv);</span>
<span class="nc" id="L168">                    String value = Model.getFacade().getValueOfTag(tv);</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">                    if ((Argo.DOCUMENTATION_TAG.equals(tag) </span>
<span class="nc bnc" id="L170" title="All 4 branches missed.">                            || Argo.DOCUMENTATION_TAG_ALT.equals(tag))</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">                        &amp;&amp; value != null &amp;&amp; value.trim().length() &gt; 0) {</span>
<span class="nc" id="L172">                        return true;</span>
                    }
<span class="nc" id="L174">                }</span>
            }
        }
<span class="nc" id="L177">        return false;</span>
    }

    /**
     * Generate default documentation.
     *
     * @param o the ModelElement
     * @param indent the current indentation string for new lines
     * @return the default documentation
     */
    public static String defaultFor(Object o, String indent) {
<span class="nc bnc" id="L188" title="All 2 branches missed.">	if (Model.getFacade().isAClass(o)) {</span>
            // TODO: Needs localization
<span class="nc" id="L190">	    return &quot; A class that represents ...\n\n&quot;</span>
		+ indent + &quot; @see OtherClasses\n&quot;
		+ indent + &quot; @author your_name_here&quot;;
	}
<span class="nc bnc" id="L194" title="All 2 branches missed.">	if (Model.getFacade().isAAttribute(o)) {</span>

<span class="nc" id="L196">	    return &quot; An attribute that represents ...&quot;;</span>
	}

<span class="nc bnc" id="L199" title="All 2 branches missed.">	if (Model.getFacade().isAOperation(o)) {</span>
<span class="nc" id="L200">	    return &quot; An operation that does...\n\n&quot;</span>
		+ indent + &quot; @param firstParam a description of this parameter&quot;;
	}
<span class="nc bnc" id="L203" title="All 2 branches missed.">	if (Model.getFacade().isAInterface(o)) {</span>
<span class="nc" id="L204">	    return &quot; An interface defining operations expected of ...\n\n&quot;</span>
		+ indent + &quot; @see OtherClasses\n&quot;
		+ indent + &quot; @author your_name_here&quot;;
	}
<span class="nc bnc" id="L208" title="All 2 branches missed.">	if (Model.getFacade().isAModelElement(o)) {</span>
<span class="nc" id="L209">	    return &quot;\n&quot;;</span>
	}

<span class="nc" id="L212">	return null;</span>
    }


    ////////////////////////////////////////////////////////////////
    // comments

    /**
     * Get the comments (the notes in a diagram) for a modelelement.&lt;p&gt;
     *
     * This returns a c-style comments.
     *
     * @param o The modelelement.
     * @return a String.
     */
    public static String getComments(Object o) {
<span class="nc" id="L228">        return getComments(o, &quot;/*&quot;, &quot; * &quot;, &quot; */&quot;);</span>
    }

    /**
     * Get the comments (the notes in a diagram) for a modelelement.
     *
     * @return a string with the comments.
     * @param o The given modelelement.
     * @param header is the comment header.
     * @param prefix is the comment prefix (on every line).
     * @param footer is the comment footer.
     */
    public static String getComments(Object o,
				     String header, String prefix,
				     String footer) {
<span class="nc" id="L243">	StringBuffer result = new StringBuffer();</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">	if (header != null) {</span>
<span class="nc" id="L245">	    result.append(header).append(LINE_SEPARATOR);</span>
	}

<span class="nc bnc" id="L248" title="All 2 branches missed.">	if (Model.getFacade().isAUMLElement(o)) {</span>
<span class="nc" id="L249">	    Collection comments = Model.getFacade().getComments(o);</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">	    if (!comments.isEmpty()) {</span>
<span class="nc" id="L251">		int nlcount = 2;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">		for (Iterator iter = comments.iterator(); iter.hasNext();) {</span>
<span class="nc" id="L253">		    Object c = iter.next();</span>
<span class="nc" id="L254">		    String s = Model.getFacade().getName(c);</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">		    nlcount = appendComment(result,</span>
					    prefix,
					    s,
					    nlcount &gt; 1 ? 0 : 1);
<span class="nc" id="L259">		}</span>
<span class="nc" id="L260">	    } else {</span>
<span class="nc" id="L261">		return &quot;&quot;;</span>
	    }
<span class="nc" id="L263">	} else {</span>
<span class="nc" id="L264">	    return &quot;&quot;;</span>
	}

<span class="nc bnc" id="L267" title="All 2 branches missed.">	if (footer != null) {</span>
<span class="nc" id="L268">	    result.append(footer).append(LINE_SEPARATOR);</span>
	}

<span class="nc" id="L271">	return result.toString();</span>
    }

    /**
     * Append a string to sb which is chopped into lines and each line
     * prefixed with prefix.
     *
     * @param sb the StringBuffer to append to.
     * @param prefix the prefix to each line.
     * @param comment the text to reformat.
     * @param nlprefix the number of empty lines to prefix the comment with.
     * @return the number of pending empty lines.
     */
    private static int appendComment(StringBuffer sb, String prefix,
				      String comment, int nlprefix) {
<span class="nc" id="L286">	int nlcount = 0;</span>

<span class="nc bnc" id="L288" title="All 2 branches missed.">	for (; nlprefix &gt; 0; nlprefix--) {</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">	    if (prefix != null) {</span>
<span class="nc" id="L290">	        sb.append(prefix);</span>
	    }
<span class="nc" id="L292">	    sb.append(LINE_SEPARATOR);</span>
<span class="nc" id="L293">	    nlcount++;</span>
	}

<span class="nc bnc" id="L296" title="All 2 branches missed.">	if (comment == null) {</span>
<span class="nc" id="L297">	    return nlcount;</span>
	}

<span class="nc" id="L300">	MyTokenizer tokens = new MyTokenizer(comment,</span>
					     &quot;&quot;,
					     MyTokenizer.LINE_SEPARATOR);

<span class="nc bnc" id="L304" title="All 2 branches missed.">	while (tokens.hasMoreTokens()) {</span>
<span class="nc" id="L305">	    String s = tokens.nextToken();</span>
<span class="nc bnc" id="L306" title="All 4 branches missed.">	    if (!s.startsWith(&quot;\r&quot;) &amp;&amp; !s.startsWith(&quot;\n&quot;)) {</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">		if (prefix != null) {</span>
<span class="nc" id="L308">		    sb.append(prefix);</span>
                }
<span class="nc" id="L310">		sb.append(s);</span>
<span class="nc" id="L311">		sb.append(LINE_SEPARATOR);</span>
<span class="nc" id="L312">		nlcount = 0;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">	    } else if (nlcount &gt; 0) {</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">		if (prefix != null) {</span>
<span class="nc" id="L315">		    sb.append(prefix);</span>
                }
<span class="nc" id="L317">		sb.append(LINE_SEPARATOR);</span>
<span class="nc" id="L318">		nlcount++;</span>
	    } else {
<span class="nc" id="L320">		nlcount++;</span>
	    }
<span class="nc" id="L322">	}</span>

<span class="nc" id="L324">	return nlcount;</span>
    }

} /* end class DocumentationManager */




</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>