<?xml version="1.0" encoding="UTF-8"?>
<pmd-cpd>
<duplication lines="419" tokens="1218">
<file line="148" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/UMLModelElementListModel2.java"/>
<file line="145" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/UMLStereotypeListModel.java"/>
<codefragment>
<![CDATA[
    public UMLModelElementListModel2(
	    String name,
	    Object theMetaType,
	    boolean reverseTheDropConnection) {
        super();
        this.metaType = theMetaType;
        eventName = name;
        this.reverseDropConnection = reverseTheDropConnection;
    }

    /**
     * Get the type of objects that this list model is designed to contain.
     * @return metaType the meta type.
     */
    public Object getMetaType() {
	return metaType;
    }

    public boolean isReverseDropConnection() {
	return reverseDropConnection;
    }

    /**
     * @param building The buildingModel to set.
     */
    protected void setBuildingModel(boolean building) {
        this.buildingModel = building;
    }

    /**
     * @param t the list target to set
     */
    protected void setListTarget(Object t) {
        this.listTarget = t;
    }

    /*
     * @see java.beans.PropertyChangeListener#propertyChange(java.beans.PropertyChangeEvent)
     *
     * TODO: This should be reviewed to see if it can be improved with a view
     * towards removing some of the overrriding methods used as workarounds for
     * differences between NSUML and MDR - tfm - 20060302
     */
    public void propertyChange(PropertyChangeEvent e) {
        if (e instanceof AttributeChangeEvent) {
            try {
                if (isValidEvent(e)) {
                    rebuildModelList();
                }
            } catch (InvalidElementException iee) {
                return;
            }
        } else if (e instanceof AddAssociationEvent) {
            if (isValidEvent(e)) {
                Object o = getChangedElement(e);
                if (o instanceof Collection) {
                    ArrayList tempList = new ArrayList((Collection) o);
                    Iterator it = tempList.iterator();
                    while (it.hasNext()) {
                        Object o2 = it.next();
                        addElement(o2);
                    }
                } else {
                    /* TODO: If this is an ordered list, then you have to
                        add in the right location! */
                    addElement(o);
                }
            }
        } else if (e instanceof RemoveAssociationEvent) {
            boolean valid = false;
            if (!(getChangedElement(e) instanceof Collection)) {
                valid = contains(getChangedElement(e));
            } else {
                Collection col = (Collection) getChangedElement(e);
                Iterator it = col.iterator();
                valid = true;
                while (it.hasNext()) {
                    Object o = it.next();
                    if (!contains(o)) {
                        valid = false;
                        break;
                    }
                }
            }
            if (valid) {
                Object o = getChangedElement(e);
                if (o instanceof Collection) {
                    Iterator it = ((Collection) o).iterator();
                    while (it.hasNext()) {
                        Object o3 = it.next();
                        removeElement(o3);
                    }
                } else {
                    removeElement(o);
                }
            }
        }
    }

    /**
     * Delete and rebuild the model list from scratch.
     */
    private void rebuildModelList() {
        removeAllElements();
        buildingModel = true;
        try {
            buildModelList();
        } catch (InvalidElementException exception) {
            /*
             * This can throw an exception if the target has been
             * deleted. We don't want to try locking the repository
             * because this is called from the event delivery thread and
             * could cause a deadlock. Instead catch the exception and
             * leave the model empty.
             */
            LOG.log(Level.FINE, "buildModelList threw exception for target "+ getTarget() + ": ",
                    exception);
        } finally {
            buildingModel = false;
        }
        if (getSize() > 0) {
            fireIntervalAdded(this, 0, getSize() - 1);
        }
    }

    /**
     * Builds the list of elements. Called from targetChanged every time the
     * target of the proppanel is changed. Usually the method setAllElements is
     * called with the result.
     */
    protected abstract void buildModelList();

    /**
     * Utility method to set the elements of this list to the contents of the
     * given collection.
     * @param col the given collection
     */
    protected void setAllElements(Collection col) {
        if (!isEmpty()) {
            removeAllElements();
        }
        addAll(col);
    }

    /**
     * Utility method to add a collection of elements to the model
     * @param col the given collection
     */
    protected void addAll(Collection col) {
        if (col.size() == 0) {
            return;
        }
        Iterator it = col.iterator();
        fireListEvents = false;
        int intervalStart = getSize() == 0 ? 0 : getSize() - 1;
        while (it.hasNext()) {
            Object o = it.next();
            addElement(o);
        }
        fireListEvents = true;
        fireIntervalAdded(this, intervalStart, getSize() - 1);
    }

    /**
     * Utility method to get the target. Sets the target if the target is null
     * via the method setTarget().
     * @return MModelElement
     */
    public Object getTarget() {
        return listTarget;
    }

    /**
     * Utility method to get the changed element from some event e
     * @param e the event
     * @return Object the changed element
     */
    protected Object getChangedElement(PropertyChangeEvent e) {
        if (e instanceof AssociationChangeEvent) {
            return ((AssociationChangeEvent) e).getChangedValue();
        }
        if (e instanceof AttributeChangeEvent) {
            return ((AttributeChangeEvent) e).getSource();
        }
        return e.getNewValue();
    }

    /*
     * @see javax.swing.DefaultListModel#contains(java.lang.Object)
     */
    public boolean contains(Object elem) {
        if (super.contains(elem)) {
            return true;
        }
        if (elem instanceof Collection) {
            Iterator it = ((Collection) elem).iterator();
            while (it.hasNext()) {
                if (!super.contains(it.next())) {
                    return false;
                }
            }
            return true;
        }
        return false;
    }

    /**
     * Sets the target. If the old target is a ModelElement, it also removes
     * the model from the element listener list of the target. If the new target
     * is instanceof ModelElement, the model is added as element listener to the
     * new target. <p>
     *
     * This function is called when the user changes the target.
     * Hence, this shall not result in any UML model changes.
     * Hence, we block firing list events completely by setting
     * buildingModel to true for the duration of this function. <p>
     *
     * This function looks a lot like the one in UMLComboBoxModel2.
     *
     * @param theNewTarget the new target
     */
    public void setTarget(Object theNewTarget) {
        theNewTarget = theNewTarget instanceof Fig
            ? ((Fig) theNewTarget).getOwner() : theNewTarget;
        if (Model.getFacade().isAUMLElement(theNewTarget)
                || theNewTarget instanceof Diagram) {
            if (Model.getFacade().isAUMLElement(listTarget)) {
                Model.getPump().removeModelEventListener(this, listTarget,
                        eventName);
                // Allow listening to other elements:
                removeOtherModelEventListeners(listTarget);
            }

            if (Model.getFacade().isAUMLElement(theNewTarget)) {
                listTarget = theNewTarget;
                Model.getPump().addModelEventListener(this, listTarget,
                        eventName);
                // Allow listening to other elements:
                addOtherModelEventListeners(listTarget);

                rebuildModelList();

            } else {
                listTarget = null;
                removeAllElements();
            }
        }
    }

    /**
     * This function allows subclasses to listen to more modelelements.
     * The given target is guaranteed to be a UML modelelement.
     *
     * @param oldTarget the UML modelelement
     */
    protected void removeOtherModelEventListeners(Object oldTarget) {
        /* Do nothing by default. */
    }

    /**
     * This function allows subclasses to listen to more modelelements.
     * The given target is guaranteed to be a UML modelelement.
     *
     * @param newTarget the UML modelelement
     */
    protected void addOtherModelEventListeners(Object newTarget) {
        /* Do nothing by default. */
    }

    /**
     * Returns true if the given element is valid, i.e. it may be added to the
     * list of elements.
     *
     * @param element the element to be tested
     * @return true if valid
     */
    protected abstract boolean isValidElement(Object element);

    /**
     * Returns true if some event is valid. An event is valid if the
     * element changed in the event is valid. This is determined via a
     * call to isValidElement.  This method can be overriden by
     * subclasses if they cannot determine if it is a valid event just
     * by checking the changed element.
     *
     * @param e the event
     * @return boolean true if valid
     */
    protected boolean isValidEvent(PropertyChangeEvent e) {
        boolean valid = false;
        if (!(getChangedElement(e) instanceof Collection)) {
            // TODO: Considering all delete events to be valid like below
            // is going to cause lots of unecessary work and some problems
            if ((e.getNewValue() == null && e.getOldValue() != null)
                    // Don't test changed element if it was deleted
                    || isValidElement(getChangedElement(e))) {
                valid = true; // we tried to remove a value
            }
        } else {
            Collection col = (Collection) getChangedElement(e);
            Iterator it = col.iterator();
            if (!col.isEmpty()) {
                valid = true;
                while (it.hasNext()) {
                    Object o = it.next();
                    if (!isValidElement(o)) {
                        valid = false;
                        break;
                    }
                }
            } else {
                if (e.getOldValue() instanceof Collection
                    && !((Collection) e.getOldValue()).isEmpty()) {
                    valid = true;
                }
            }
        }
        return valid;
    }

    /*
     * @see javax.swing.DefaultListModel#addElement(java.lang.Object)
     */
    public void addElement(Object obj) {
        if (obj != null && !contains(obj)) {
            super.addElement(obj);
        }
    }

    /**
     * Returns the eventName. This method is only here for testing goals.
     * @return String
     */
    String getEventName() {
        return eventName;
    }

    /**
     * Sets the eventName. The eventName is the name of the
     * MElementEvent to which the list should listen. The list is
     * registred with UMLModelEventPump and only gets events that have
     * a name like eventName.  This method should be called in the
     * constructor of every subclass.
     *
     * @param theEventName The eventName to set
     */
    protected void setEventName(String theEventName) {
        eventName = theEventName;
    }

    /*
     * @see TargetListener#targetAdded(TargetEvent)
     */
    public void targetAdded(TargetEvent e) {
        setTarget(e.getNewTarget());
    }

    /*
     * @see TargetListener#targetRemoved(TargetEvent)
     */
    public void targetRemoved(TargetEvent e) {
        setTarget(e.getNewTarget());
    }

    /*
     * @see TargetListener#targetSet(TargetEvent)
     */
    public void targetSet(TargetEvent e) {
        setTarget(e.getNewTarget());
    }

    /*
     * @see javax.swing.AbstractListModel#fireContentsChanged(
     *          Object, int, int)
     */
    protected void fireContentsChanged(Object source, int index0, int index1) {
        if (fireListEvents && !buildingModel) {
            super.fireContentsChanged(source, index0, index1);
        }
    }

    /*
     * @see javax.swing.AbstractListModel#fireIntervalAdded(
     *          Object, int, int)
     */
    protected void fireIntervalAdded(Object source, int index0, int index1) {
        if (fireListEvents && !buildingModel) {
            super.fireIntervalAdded(source, index0, index1);
        }
    }

    /*
     * @see javax.swing.AbstractListModel#fireIntervalRemoved(
     *          Object, int, int)
     */
    protected void fireIntervalRemoved(Object source, int index0, int index1) {
        if (fireListEvents && !buildingModel) {
            super.fireIntervalRemoved(source, index0, index1);
        }
    }

    /**
     * Override this if you want a popup menu.
     * See for an example UMLModelElementOrderedListModel2.
     *
     * @param popup the popup menu
     * @param index the selected item in the list at the moment
     *              the mouse was clicked
     * @return true if a popup menu is created, and needs to be shown
     */
    public boolean buildPopup(JPopupMenu popup, int index) {
        return false;
    }

    protected boolean hasPopup() {
        return false;
    }

}
]]>
</codefragment>
</duplication>
<duplication lines="125" tokens="469">
<file line="1430" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigEdgeModelElement.java"/>
<file line="2167" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigNodeModelElement.java"/>
<codefragment>
<![CDATA[
    }


    /**
     * Add an element listener and remember the registration.
     *
     * @param element
     *            element to listen for changes on
     * @see org.argouml.model.ModelEventPump#addModelEventListener(PropertyChangeListener, Object, String)
     */
    protected void addElementListener(Object element) {
        listeners.add(new Object[] {element, null});
        Model.getPump().addModelEventListener(this, element);
    }

    /**
     * Add a listener and remember the registration.
     *
     * @param element
     *            element to listen for changes on
     * @param property
     *            name of property to listen for changes of
     * @see org.argouml.model.ModelEventPump#addModelEventListener(PropertyChangeListener, Object, String)
     */
    protected void addElementListener(Object element, String property) {
        listeners.add(new Object[] {element, property});
        Model.getPump().addModelEventListener(this, element, property);
    }

    /**
     * Add a listener and remember the registration.
     *
     * @param element
     *            element to listen for changes on
     * @param property
     *            array of property names (Strings) to listen for changes of
     * @see org.argouml.model.ModelEventPump#addModelEventListener(PropertyChangeListener, Object, String)
     */
    protected void addElementListener(Object element, String[] property) {
        listeners.add(new Object[] {element, property});
        Model.getPump().addModelEventListener(this, element, property);
    }

    /**
     * Add an element listener and remember the registration.
     *
     * @param element
     *            element to listen for changes on
     * @see org.argouml.model.ModelEventPump#addModelEventListener(PropertyChangeListener, Object, String)
     */
    protected void removeElementListener(Object element) {
        listeners.remove(new Object[] {element, null});
        Model.getPump().removeModelEventListener(this, element);
    }


    /**
     * Unregister all listeners registered through addElementListener
     * @see #addElementListener(Object, String)
     */
    protected void removeAllElementListeners() {
        removeElementListeners(listeners);
    }

    private void removeElementListeners(Set<Object[]> listenerSet) {
        for (Object[] listener : listenerSet) {
            Object property = listener[1];
            if (property == null) {
                Model.getPump().removeModelEventListener(this, listener[0]);
            } else if (property instanceof String[]) {
                Model.getPump().removeModelEventListener(this, listener[0],
                        (String[]) property);
            } else if (property instanceof String) {
                Model.getPump().removeModelEventListener(this, listener[0],
                        (String) property);
            } else {
                throw new RuntimeException(
                        "Internal error in removeAllElementListeners");
            }
        }
        listeners.removeAll(listenerSet);
    }

    private void addElementListeners(Set<Object[]> listenerSet) {
        for (Object[] listener : listenerSet) {
            Object property = listener[1];
            if (property == null) {
                addElementListener(listener[0]);
            } else if (property instanceof String[]) {
                addElementListener(listener[0], (String[]) property);
            } else if (property instanceof String) {
                addElementListener(listener[0], (String) property);
            } else {
                throw new RuntimeException(
                        "Internal error in addElementListeners");
            }
        }
    }

    /**
     * Update the set of registered listeners to match the given set using
     * a minimal update strategy to remove unneeded listeners and add new
     * listeners.
     *
     * @param listenerSet a set of arrays containing a tuple of a UML element
     * to be listened to and a set of property to be listened for.
     */
    protected void updateElementListeners(Set<Object[]> listenerSet) {
        Set<Object[]> removes = new HashSet<Object[]>(listeners);
        removes.removeAll(listenerSet);
        removeElementListeners(removes);

        Set<Object[]> adds = new HashSet<Object[]>(listenerSet);
        adds.removeAll(listeners);
        addElementListeners(adds);
    }

    /**
     * This optional method is not implemented.  It will throw an
     * {@link UnsupportedOperationException} if used. Figs are
     * added to a GraphModel which is, in turn, owned by a project.
     * @param project the project
     * @deprecated
     */
    @SuppressWarnings("deprecation")
]]>
</codefragment>
</duplication>
<duplication lines="122" tokens="352">
<file line="547" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/activity/ui/UMLActivityDiagram.java"/>
<file line="628" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/UMLStateDiagram.java"/>
<codefragment>
<![CDATA[
    }
    /**
     * @return Returns the actionTransition.
     */
    protected Action getActionTransition() {
        if (actionTransition == null) {
            actionTransition =
                new RadioAction(
                        new ActionSetMode(
                                ModeCreatePolyEdge.class,
                                "edgeClass",
                                Model.getMetaTypes().getTransition(),
                        "button.new-transition"));
        }
        return actionTransition;
    }

    /**
     * @return Returns the actionCallEvent.
     */
    protected Action getActionCallEvent() {
        if (actionCallEvent == null) {
            actionCallEvent = new ButtonActionNewCallEvent();
        }
        return actionCallEvent;
    }

    /**
     * @return Returns the actionCallEvent.
     */
    protected Action getActionChangeEvent() {
        if (actionChangeEvent == null) {
            actionChangeEvent = new ButtonActionNewChangeEvent();
        }
        return actionChangeEvent;
    }

    /**
     * @return Returns the actionCallEvent.
     */
    protected Action getActionSignalEvent() {
        if (actionSignalEvent == null) {
            actionSignalEvent = new ButtonActionNewSignalEvent();
        }
        return actionSignalEvent;
    }

    /**
     * @return Returns the actionCallEvent.
     */
    protected Action getActionTimeEvent() {
        if (actionTimeEvent == null) {
            actionTimeEvent = new ButtonActionNewTimeEvent();
        }
        return actionTimeEvent;
    }

    protected Action getActionGuard() {
        if (actionGuard == null) {
            actionGuard = new ButtonActionNewGuard();
        }
        return actionGuard;
    }

    protected Action getActionCallAction() {
        if (actionCallAction == null) {
            actionCallAction = ActionNewCallAction.getButtonInstance();
        }
        return actionCallAction;
    }

    protected Action getActionCreateAction() {
        if (actionCreateAction == null) {
            actionCreateAction = ActionNewCreateAction.getButtonInstance();
        }
        return actionCreateAction;
    }

    protected Action getActionDestroyAction() {
        if (actionDestroyAction == null) {
            actionDestroyAction = ActionNewDestroyAction.getButtonInstance();
        }
        return actionDestroyAction;
    }

    protected Action getActionReturnAction() {
        if (actionReturnAction == null) {
            actionReturnAction = ActionNewReturnAction.getButtonInstance();
        }
        return actionReturnAction;
    }

    protected Action getActionSendAction() {
        if (actionSendAction == null) {
            actionSendAction = ActionNewSendAction.getButtonInstance();
        }
        return actionSendAction;
    }

    protected Action getActionTerminateAction() {
        if (actionTerminateAction == null) {
            actionTerminateAction =
                ActionNewTerminateAction.getButtonInstance();
        }
        return actionTerminateAction;
    }

    protected Action getActionUninterpretedAction() {
        if (actionUninterpretedAction == null) {
            actionUninterpretedAction =
                ActionNewUninterpretedAction.getButtonInstance();
        }
        return actionUninterpretedAction;
    }

    protected Action getActionActionSequence() {
        if (actionActionSequence == null) {
            actionActionSequence =
                ActionNewActionSequence.getButtonInstance();
        }
        return actionActionSequence;
    }
]]>
</codefragment>
</duplication>
<duplication lines="66" tokens="339">
<file line="56" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/MenuBar14.java"/>
<file line="56" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/MenuBar2.java"/>
<codefragment>
<![CDATA[
public class MenuBar14 extends GenericArgoMenuBar {
    
    /**
     * Build the menu "Create" and the toolbar for diagram creation. These are
     * build together to guarantee that the same items are present in both, and
     * in the same sequence.
     * <p>
     * 
     * The sequence of these items was determined by issue 1821.
     */
    protected void initMenuCreate() {
        super.initMenuCreate();
        getCreateDiagramMenu().removeAll();
        getCreateDiagramToolbar().removeAll();
        JMenuItem usecaseDiagram = getCreateDiagramMenu()
                .add(new ActionUseCaseDiagram());
        setMnemonic(usecaseDiagram, "Usecase Diagram");
        getCreateDiagramToolbar().add((new ActionUseCaseDiagram()));
        ShortcutMgr.assignAccelerator(usecaseDiagram,
                ShortcutMgr.ACTION_USE_CASE_DIAGRAM);

        JMenuItem classDiagram =
            getCreateDiagramMenu().add(new ActionClassDiagram());
        setMnemonic(classDiagram, "Class Diagram");
        getCreateDiagramToolbar().add((new ActionClassDiagram()));
        ShortcutMgr.assignAccelerator(classDiagram,
                ShortcutMgr.ACTION_CLASS_DIAGRAM);

        JMenuItem sequenzDiagram =
            getCreateDiagramMenu().add(new ActionSequenceDiagram());
        setMnemonic(sequenzDiagram, "Sequenz Diagram");
        getCreateDiagramToolbar().add((new ActionSequenceDiagram()));
        ShortcutMgr.assignAccelerator(sequenzDiagram,
                ShortcutMgr.ACTION_SEQUENCE_DIAGRAM);
        
        JMenuItem collaborationDiagram =
            getCreateDiagramMenu().add(new ActionCollaborationDiagram());
        setMnemonic(collaborationDiagram, "Collaboration Diagram");
        getCreateDiagramToolbar().add((new ActionCollaborationDiagram()));
        ShortcutMgr.assignAccelerator(collaborationDiagram,
                ShortcutMgr.ACTION_COLLABORATION_DIAGRAM);

        JMenuItem stateDiagram =
            getCreateDiagramMenu().add(new ActionStateDiagram());
        setMnemonic(stateDiagram, "State Diagram");
        getCreateDiagramToolbar().add((new ActionStateDiagram()));
        ShortcutMgr.assignAccelerator(stateDiagram,
                ShortcutMgr.ACTION_STATE_DIAGRAM);

        JMenuItem activityDiagram =
            getCreateDiagramMenu().add(new ActionActivityDiagram());
        setMnemonic(activityDiagram, "Activity Diagram");
        getCreateDiagramToolbar().add((new ActionActivityDiagram()));
        ShortcutMgr.assignAccelerator(activityDiagram,
                ShortcutMgr.ACTION_ACTIVITY_DIAGRAM);

        JMenuItem deploymentDiagram =
            getCreateDiagramMenu().add(new ActionDeploymentDiagram());
        setMnemonic(deploymentDiagram, "Deployment Diagram");
        getCreateDiagramToolbar().add((new ActionDeploymentDiagram()));
        ShortcutMgr.assignAccelerator(deploymentDiagram,
                ShortcutMgr.ACTION_DEPLOYMENT_DIAGRAM);

        getCreateDiagramToolbar().setFloatable(true);
    }
}
]]>
</codefragment>
</duplication>
<duplication lines="57" tokens="267">
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/ComponentInstanceNotationUml.java"/>
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/NodeInstanceNotationUml.java"/>
<codefragment>
<![CDATA[
        super(componentInstance);
    }

    /**
     * Parse a line of the form: "name : base-component".
     * <p>
     * The base-component part is a comma separated list of Components. <p>
     * 
     * Note that stereotypes are not supported.
     *
     * {@inheritDoc}
     */
    public void parse(Object modelElement, String text) {
        // strip any trailing semi-colons
        String s = text.trim();
        if (s.length() == 0) {
            return;
        }
        if (s.charAt(s.length() - 1) == ';') {
            s = s.substring(0, s.length() - 2);
        }

        String name = "";
        String bases = "";
        StringTokenizer tokenizer = null;

        if (s.indexOf(":", 0) > -1) {
            name = s.substring(0, s.indexOf(":")).trim();
            bases = s.substring(s.indexOf(":") + 1).trim();
        } else {
            name = s;
        }

        tokenizer = new StringTokenizer(bases, ",");

        List<Object> classifiers = new ArrayList<Object>();
        Object ns = Model.getFacade().getNamespace(modelElement);
        if (ns != null) {
            while (tokenizer.hasMoreElements()) {
                String newBase = tokenizer.nextToken();
                Object cls = Model.getFacade().lookupIn(ns, newBase.trim());
                if (cls != null) {
                    classifiers.add(cls);
                }
            }
        }

        Model.getCommonBehaviorHelper().setClassifiers(modelElement,
                classifiers);
        Model.getCoreHelper().setName(modelElement, name);
    }

    /*
     * @see org.argouml.notation.providers.NotationProvider#getParsingHelp()
     */
    public String getParsingHelp() {
        return "parsing.help.fig-componentinstance";
]]>
</codefragment>
</duplication>
<duplication lines="99" tokens="265">
<file line="100" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigForkState.java"/>
<file line="100" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJoinState.java"/>
<codefragment>
<![CDATA[
        FigForkState figClone = (FigForkState) super.clone();
        Iterator it = figClone.getFigs().iterator();
        figClone.setBigPort((FigRect) it.next());
        figClone.head = (FigRect) it.next();
        return figClone;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setBounds(int, int, int, int)
     */
    @Override
    protected void setStandardBounds(int x, int y, int w, int h) {
        Rectangle oldBounds = getBounds();
        if (w > h) {
            h = HEIGHT;
        } else {
            w = HEIGHT;
        }
        getBigPort().setBounds(x, y, w, h);
        head.setBounds(x, y, w, h);

        calcBounds();
        updateEdges();
        firePropChange("bounds", oldBounds, getBounds());
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        // noop - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }
   
    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
    public void mouseClicked(MouseEvent me) {
        // ignored
    }

    /**
     * The UID.
     */
    static final long serialVersionUID = 6702818473439087473L;
]]>
</codefragment>
</duplication>
<duplication lines="53" tokens="242">
<file line="382" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/TabProps.java"/>
<file line="482" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/TabStyle.java"/>
<codefragment>
<![CDATA[
        repaint();
    }

    /**
     * Adds a listener.
     * @param listener the listener to add
     */
    private void addTargetListener(TargetListener listener) {
        listenerList.add(TargetListener.class, listener);
    }

    /**
     * Removes a target listener.
     * @param listener the listener to remove
     */
    private void removeTargetListener(TargetListener listener) {
        listenerList.remove(TargetListener.class, listener);
    }

    private void fireTargetSet(TargetEvent targetEvent) {
        //      Guaranteed to return a non-null array
        Object[] listeners = listenerList.getListenerList();
        for (int i = listeners.length - 2; i >= 0; i -= 2) {
            if (listeners[i] == TargetListener.class) {
                // Lazily create the event:
		((TargetListener) listeners[i + 1]).targetSet(targetEvent);
            }
        }
    }

    private void fireTargetAdded(TargetEvent targetEvent) {
        // Guaranteed to return a non-null array
        Object[] listeners = listenerList.getListenerList();

        for (int i = listeners.length - 2; i >= 0; i -= 2) {
            if (listeners[i] == TargetListener.class) {
                // Lazily create the event:
		((TargetListener) listeners[i + 1]).targetAdded(targetEvent);
            }
        }
    }

    private void fireTargetRemoved(TargetEvent targetEvent) {
        // Guaranteed to return a non-null array
        Object[] listeners = listenerList.getListenerList();
        for (int i = listeners.length - 2; i >= 0; i -= 2) {
            if (listeners[i] == TargetListener.class) {
                // Lazily create the event:
                ((TargetListener) listeners[i + 1]).targetRemoved(targetEvent);
            }
        }
    }
} /* end class TabProps */
]]>
</codefragment>
</duplication>
<duplication lines="50" tokens="228">
<file line="125" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/java/ModelElementNameNotationJava.java"/>
<file line="321" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/NotationUtilityUml.java"/>
<codefragment>
<![CDATA[
                } else if (".".equals(token)) {
                    if (name != null) {
                        name = name.trim();
                    }

                    if (path != null && (name == null || "".equals(name))) {
                        String msg = 
                            "parsing.error.model-element-name.anon-qualifiers";
                        throw new ParseException(Translator.localize(msg), 
                                st.getTokenIndex());
                    }

                    if (path == null) {
                        path = new ArrayList<String>();
                    }
                    if (name != null) {
                        path.add(name);
                    }
                    name = null;
                
                } else { // the name itself
                    if (name != null) {
                        String msg = 
                            "parsing.error.model-element-name.twin-names";
                        throw new ParseException(Translator.localize(msg), 
                                st.getTokenIndex());
                    }
                    name = token;
                }
            }
        } catch (NoSuchElementException nsee) {
            String msg = 
                "parsing.error.model-element-name.unexpected-name-element";
            throw new ParseException(Translator.localize(msg),
                    text.length());
        } catch (ParseException pre) {
            throw pre;
        }
        
        if (name != null) {
            name = name.trim();
        }
        
        if (path != null && (name == null || "".equals(name))) {
            String msg = "parsing.error.model-element-name.must-end-with-name";
            throw new ParseException(Translator.localize(msg), 0);
        }
        
        /* Check the name for validity: */
        if (!isValidJavaClassName(name)) {
]]>
</codefragment>
</duplication>
<duplication lines="34" tokens="226">
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionAddDataType.java"/>
<file line="66" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionAddEnumeration.java"/>
<codefragment>
<![CDATA[
        putValue(Action.NAME, Translator.localize("button.new-datatype"));
    }

    /*
     * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
     */
    public void actionPerformed(ActionEvent e) {
        Object target = TargetManager.getInstance().getModelTarget();
        Object ns = null;
        if (Model.getFacade().isANamespace(target)) {
            ns = target;
        }
        if (Model.getFacade().isAParameter(target)) {
            if (Model.getFacade().getBehavioralFeature(target) != null) {
                target = Model.getFacade().getBehavioralFeature(target);
            }
        }
        if (Model.getFacade().isAFeature(target)) {
            if (Model.getFacade().getOwner(target) != null) {
                target = Model.getFacade().getOwner(target);
            }
        }
        if (Model.getFacade().isAEvent(target)) {
            ns = Model.getFacade().getNamespace(target);
        }
        if (Model.getFacade().isAClassifier(target)) {
            ns = Model.getFacade().getNamespace(target);
        }
        if (Model.getFacade().isAAssociationEnd(target)) {
            target = Model.getFacade().getAssociation(target);
            ns = Model.getFacade().getNamespace(target);
        }

        Object newDt = Model.getCoreFactory().buildDataType("", ns);
]]>
</codefragment>
</duplication>
<duplication lines="66" tokens="222">
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInstanceWithoutClassifier.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInterfaceWithoutComponent.java"/>
<codefragment>
<![CDATA[
    public CrInstanceWithoutClassifier() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
	    return NO_PROBLEM;
	}
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
	    return NO_PROBLEM;
	}
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
	    return false;
	}
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }

    /**
     * If there are instances that have no classifiers they belong to
     * the returned ListSet is not null. Then in the ListSet
     * are the UMLDeploymentDiagram and all FigObjects, FigComponentInstances
     * and FigMNodeInstances with no classifier.
     *
     * @param dd the diagram to check
     * @return the set of offenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram dd) {
	Collection figs = dd.getLayer().getContents();
	ListSet offs = null;
        Iterator figIter = figs.iterator();
	while (figIter.hasNext()) {
	    Object obj = figIter.next();
	    if (!(obj instanceof FigNodeModelElement)) {
]]>
</codefragment>
</duplication>
<duplication lines="68" tokens="221">
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceInsideElement.java"/>
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceWithoutClassifier.java"/>
<codefragment>
<![CDATA[
    public CrNodeInstanceInsideElement() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
            return NO_PROBLEM;
        }
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
            return NO_PROBLEM;
        }
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
            return false;
        }
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }

    /**
     * If there are node-instances that have an enclosing Fig
     * the returned vector-set is not null. Then in the vector-set
     * are the UMLDeploymentDiagram and all FigMNodeInstances with an
     * enclosing Fig
     *
     * @param dd the diagram to check
     * @return the set of offenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram dd) {
	Collection figs = dd.getLayer().getContents();
	ListSet offs = null;
        for (Object obj : figs) {
	    if (!(obj instanceof FigNodeInstance)) {
                continue;
            }
	    FigNodeInstance fn = (FigNodeInstance) obj;
	    if (fn.getEnclosingFig() != null) {
]]>
</codefragment>
</duplication>
<duplication lines="67" tokens="218">
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutClassifier.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutComponent.java"/>
<codefragment>
<![CDATA[
    public CrObjectWithoutClassifier() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
            return NO_PROBLEM;
        }
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
	    return NO_PROBLEM;
	}
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
            return false;
        }
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }

    /**
     * If there are objects that are not inside a component or a
     * component-instance the returned vector-set is not null. Then in
     * the vector-set are the UMLDeploymentDiagram and all FigObjects
     * with no enclosing FigComponent or FigComponentInstance
     *
     * @param dd the diagram to check
     * @return the set of offenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram dd) {
	Collection figs = dd.getLayer().getContents();
	ListSet offs = null;
        for (Object obj : figs) {
	    if (!(obj instanceof FigObject)) {
                continue;
            }
	    FigObject fo = (FigObject) obj;
]]>
</codefragment>
</duplication>
<duplication lines="39" tokens="212">
<file line="70" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepConfirm.java"/>
<file line="73" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepTextField.java"/>
<codefragment>
<![CDATA[
	instructions.setWrapStyleWord(true);

	getMainPanel().setBorder(new EtchedBorder());

	GridBagLayout gb = new GridBagLayout();
	getMainPanel().setLayout(gb);

	GridBagConstraints c = new GridBagConstraints();
	c.ipadx = 3; c.ipady = 3;
	c.weightx = 0.0; c.weighty = 0.0;
	c.anchor = GridBagConstraints.EAST;

	JLabel image = new JLabel("");
	//image.setMargin(new Insets(0, 0, 0, 0));
	image.setIcon(getWizardIcon());
	image.setBorder(null);
	c.gridx = 0;
	c.gridheight = 4;
	c.gridy = 0;
	gb.setConstraints(image, c);
	getMainPanel().add(image);

	c.weightx = 1.0;
	c.gridx = 2;
	c.gridheight = 1;
	c.gridwidth = 3;
	c.gridy = 0;
	c.fill = GridBagConstraints.HORIZONTAL;
	gb.setConstraints(instructions, c);
	getMainPanel().add(instructions);

	c.gridx = 1;
	c.gridy = 1;
	c.weightx = 0.0;
	c.gridwidth = 1;
	c.fill = GridBagConstraints.NONE;
	SpacerPanel spacer = new SpacerPanel();
	gb.setConstraints(spacer, c);
	getMainPanel().add(spacer);
]]>
</codefragment>
</duplication>
<duplication lines="22" tokens="211">
<file line="839" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/activity/ui/UMLActivityDiagram.java"/>
<file line="909" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/UMLStateDiagram.java"/>
<codefragment>
<![CDATA[
            figNode = new FigFinalState(modelElement, bounds, settings);
        } else if (Model.getFacade().isAPseudostate(modelElement)) {
            Object kind = Model.getFacade().getKind(modelElement);
            if (kind == null) {
                LOG.log(Level.WARNING, "found a null type pseudostate");
                return null;
            }
            if (kind.equals(Model.getPseudostateKind().getInitial())) {
                figNode = new FigInitialState(modelElement, bounds, settings);
            } else if (kind.equals(
                    Model.getPseudostateKind().getChoice())) {
                figNode = new FigBranchState(modelElement, bounds, settings);
            } else if (kind.equals(
                    Model.getPseudostateKind().getJunction())) {
                figNode = new FigJunctionState(modelElement, bounds, settings);
            } else if (kind.equals(
                    Model.getPseudostateKind().getFork())) {
                figNode = new FigForkState(modelElement, bounds, settings);
            } else if (kind.equals(
                    Model.getPseudostateKind().getJoin())) {
                figNode = new FigJoinState(modelElement, bounds, settings);
            } else {
]]>
</codefragment>
</duplication>
<duplication lines="64" tokens="205">
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInsideElement.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceInsideElement.java"/>
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceWithoutClassifier.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutClassifier.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutComponent.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrWrongDepEnds.java"/>
<codefragment>
<![CDATA[
    public CrNodeInsideElement() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
            return NO_PROBLEM;
        }
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
            return NO_PROBLEM;
        }
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
            return false;
        }
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }

    /**
     * If there are nodes that have an enclosing Fig
     * the returned ListSet is not null. Then in the ListSet
     * are the UMLDeploymentDiagram and all FigMNodes with an
     * enclosing Fig
     *
     * @param dd the diagram to check
     * @return the set of offenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram dd) {
	Collection figs = dd.getLayer().getContents();
	ListSet offs = null;
        for (Object obj : figs) {
	    if (!(obj instanceof FigMNode)) {
]]>
</codefragment>
</duplication>
<duplication lines="37" tokens="203">
<file line="690" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/DetailsPane.java"/>
<file line="399" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/TabProps.java"/>
<file line="503" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/TabStyle.java"/>
<codefragment>
<![CDATA[
    }

    private void fireTargetSet(TargetEvent targetEvent) {
        //          Guaranteed to return a non-null array
        Object[] listeners = listenerList.getListenerList();
        for (int i = listeners.length - 2; i >= 0; i -= 2) {
            if (listeners[i] == TargetListener.class) {
                // Lazily create the event:
		((TargetListener) listeners[i + 1]).targetSet(targetEvent);
            }
        }
    }

    private void fireTargetAdded(TargetEvent targetEvent) {
        // Guaranteed to return a non-null array
        Object[] listeners = listenerList.getListenerList();

        for (int i = listeners.length - 2; i >= 0; i -= 2) {
            if (listeners[i] == TargetListener.class) {
                // Lazily create the event:
		((TargetListener) listeners[i + 1]).targetAdded(targetEvent);
            }
        }
    }

    private void fireTargetRemoved(TargetEvent targetEvent) {
        // Guaranteed to return a non-null array
        Object[] listeners = listenerList.getListenerList();
        for (int i = listeners.length - 2; i >= 0; i -= 2) {
            if (listeners[i] == TargetListener.class) {
                // Lazily create the event:
                ((TargetListener) listeners[i + 1]).targetRemoved(targetEvent);
            }
        }
    }

}
]]>
</codefragment>
</duplication>
<duplication lines="38" tokens="200">
<file line="77" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByOffender.java"/>
<file line="124" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByOffender.java"/>
<codefragment>
<![CDATA[
        LOG.log(Level.FINE, "toDoItemsChanged");
        List<ToDoItem> items = tde.getToDoItemList();
        Object[] path = new Object[2];
        path[0] = Designer.theDesigner().getToDoList();

        ListSet allOffenders = Designer.theDesigner().getToDoList()
                .getOffenders();
        synchronized (allOffenders) {
            for (Object off : allOffenders) {
                path[1] = off;
                int nMatchingItems = 0;
                synchronized (items) {
                    for (ToDoItem item : items) {
                        ListSet offenders = item.getOffenders();
                        if (!offenders.contains(off)) {
                            continue;
                        }
                        nMatchingItems++;
                    }
                }
                if (nMatchingItems == 0) {
                    continue;
                }
                int[] childIndices = new int[nMatchingItems];
                Object[] children = new Object[nMatchingItems];
                nMatchingItems = 0;
                synchronized (items) {
                    for (ToDoItem item : items) {
                        ListSet offenders = item.getOffenders();
                        if (!offenders.contains(off)) {
                            continue;
                        }
                        childIndices[nMatchingItems] = getIndexOfChild(off,
                                item);
                        children[nMatchingItems] = item;
                        nMatchingItems++;
                    }
                }
]]>
</codefragment>
</duplication>
<duplication lines="65" tokens="199">
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrComponentWithoutNode.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInstanceWithoutClassifier.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInterfaceWithoutComponent.java"/>
<codefragment>
<![CDATA[
    public CrComponentWithoutNode() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
	    return NO_PROBLEM;
	}
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
	    return NO_PROBLEM;
	}
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
	    return false;
	}
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }


    /**
     * If there are components that have no enclosing FigMNode
     * the returned ListSet is not null. Then in the ListSet
     * are the UMLDeploymentDiagram and all FigComponents with no
     * enclosing FigMNode
     *
     * @param dd the diagram to check
     * @return the set of offenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram dd) {

	Collection figs = dd.getLayer().getContents();
	ListSet offs = null;
	Iterator figIter = figs.iterator();
]]>
</codefragment>
</duplication>
<duplication lines="64" tokens="191">
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrComponentWithoutNode.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInstanceWithoutClassifier.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInterfaceWithoutComponent.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInsideElement.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceInsideElement.java"/>
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceWithoutClassifier.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutClassifier.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutComponent.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrWrongDepEnds.java"/>
<codefragment>
<![CDATA[
    public CrComponentWithoutNode() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
	    return NO_PROBLEM;
	}
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
	    return NO_PROBLEM;
	}
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
	    return false;
	}
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }


    /**
     * If there are components that have no enclosing FigMNode
     * the returned ListSet is not null. Then in the ListSet
     * are the UMLDeploymentDiagram and all FigComponents with no
     * enclosing FigMNode
     *
     * @param dd the diagram to check
     * @return the set of offenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram dd) {

	Collection figs = dd.getLayer().getContents();
	ListSet offs = null;
]]>
</codefragment>
</duplication>
<duplication lines="63" tokens="191">
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrCompInstanceWithoutNode.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrComponentInstanceWithoutClassifier.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrWrongLinkEnds.java"/>
<codefragment>
<![CDATA[
    public CrCompInstanceWithoutNode() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
	    return NO_PROBLEM;
	}
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
	    return NO_PROBLEM;
	}
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem(java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
	    return false;
	}
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }

    /**
     * If there are component-instances that have no enclosing FigMNodeInstance
     * the returned ListSet is not null. Then in the ListSet
     * are the UMLDeploymentDiagram and all FigComponentInstances with no
     * enclosing FigMNodeInstance
     *
     * @param deploymentDiagram the diagram to check
     * @return the set of offenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram deploymentDiagram) {

	Collection figs = deploymentDiagram.getLayer().getContents();
	ListSet offs = null;
]]>
</codefragment>
</duplication>
<duplication lines="43" tokens="189">
<file line="225" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigClassifierBox.java"/>
<file line="191" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigInterface.java"/>
<codefragment>
<![CDATA[
        if (isCompartmentVisible(Model.getMetaTypes().getAttribute())) {
            Set<Object[]> listeners = new HashSet<Object[]>();

            // Collect the set of model elements that we want to listen to
            if (newOwner != null) {
                // TODO: Because we get called on each and every change event, when
                // the model is in a state of flux, we'll often get an
                // InvalidElementException before we finish this collection. The
                // only saving grace is that we're called SO many times that on the
                // last time, things should be stable again and we'll get a good set
                // of elements for the final update.  We need a better mechanism.
                
                // add the listeners to the newOwner
                listeners.add(new Object[] {newOwner, null});
                
                // and its stereotypes
                // TODO: Aren't stereotypes handled elsewhere?
                for (Object stereotype 
                        : Model.getFacade().getStereotypes(newOwner)) {
                    listeners.add(new Object[] {stereotype, null});
                }

                // and its features
                for (Object feat : Model.getFacade().getFeatures(newOwner)) {
                    listeners.add(new Object[] {feat, null});
                    // and the stereotypes of its features
                    for (Object stereotype 
                            : Model.getFacade().getStereotypes(feat)) {
                        listeners.add(new Object[] {stereotype, null});
                    }
                    // and the parameter of its operations
                    if (Model.getFacade().isAOperation(feat)) {
                        for (Object param : Model.getFacade().getParameters(feat)) {
                            listeners.add(new Object[] {param, null});
                        }
                    }
                }
            }
            
            // Update the listeners to match the desired set using the minimal
            // update facility
            updateElementListeners(listeners);
        } else {
]]>
</codefragment>
</duplication>
<duplication lines="35" tokens="186">
<file line="88" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInvalidForkTriggerOrGuard.java"/>
<file line="89" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInvalidJoinTriggerOrGuard.java"/>
<codefragment>
<![CDATA[
                        Model.getPseudostateKind().getFork())) {
            return NO_PROBLEM;
        }
        boolean hasTrigger =
                (t != null && Model.getFacade().getName(t) != null
                && Model.getFacade().getName(t).length() > 0);
        if (hasTrigger) {
            return PROBLEM_FOUND;
        }
        boolean noGuard =
            (g == null || Model.getFacade().getExpression(g) == null
                || Model.getFacade().getBody(Model.getFacade()
                        .getExpression(g)) == null
                || Model.getFacade().getBody(Model.getFacade()
                        .getExpression(g)).toString().length() == 0);
        if (!noGuard) {
            return PROBLEM_FOUND;
        }
        return NO_PROBLEM;
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#getCriticizedDesignMaterials()
     */
    @Override
    public Set<Object> getCriticizedDesignMaterials() {
        Set<Object> ret = new HashSet<Object>();
        ret.add(Model.getMetaTypes().getTransition());
        return ret;
    }
    
    /**
     * The UID.
     */
    private static final long serialVersionUID = -713044875133409390L;
]]>
</codefragment>
</duplication>
<duplication lines="33" tokens="183">
<file line="77" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByPoster.java"/>
<file line="119" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByPoster.java"/>
<codefragment>
<![CDATA[
        LOG.log(Level.FINE, "toDoItemsChanged");
        List<ToDoItem> items = tde.getToDoItemList();
	Object[] path = new Object[2];
	path[0] = Designer.theDesigner().getToDoList();

	ListSet<Poster> allPosters =
	    Designer.theDesigner().getToDoList().getPosters();
        synchronized (allPosters) {
            for (Poster p : allPosters) {
                path[1] = p;
                int nMatchingItems = 0;
                for (ToDoItem item : items) {
                    Poster post = item.getPoster();
                    if (post != p) {
                        continue;
                    }
                    nMatchingItems++;
                }
                if (nMatchingItems == 0) {
                    continue;
                }
                int[] childIndices = new int[nMatchingItems];
                Object[] children = new Object[nMatchingItems];
                nMatchingItems = 0;
                for (ToDoItem item : items) {
                    Poster post = item.getPoster();
                    if (post != p) {
                        continue;
                    }
                    childIndices[nMatchingItems] = getIndexOfChild(p, item);
                    children[nMatchingItems] = item;
                    nMatchingItems++;
                }
]]>
</codefragment>
</duplication>
<duplication lines="32" tokens="175">
<file line="75" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByPriority.java"/>
<file line="115" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByPriority.java"/>
<codefragment>
<![CDATA[
        LOG.log(Level.FINE, "toDoItemChanged");
        List<ToDoItem> items = tde.getToDoItemList();
	Object[] path = new Object[2];
	path[0] = Designer.theDesigner().getToDoList();

        for (PriorityNode pn : PriorityNode.getPriorityList()) {
	    path[1] = pn;
	    int nMatchingItems = 0;
	    synchronized (items) {
                for (ToDoItem item : items) {
                    if (item.getPriority() != pn.getPriority()) {
                        continue;
                    }
                    nMatchingItems++;
                }
            }
	    if (nMatchingItems == 0) {
                continue;
            }
	    int[] childIndices = new int[nMatchingItems];
	    Object[] children = new Object[nMatchingItems];
	    nMatchingItems = 0;
            synchronized (items) {
                for (ToDoItem item : items) {
                    if (item.getPriority() != pn.getPriority()) {
                        continue;
                    }
                    childIndices[nMatchingItems] = getIndexOfChild(pn, item);
                    children[nMatchingItems] = item;
                    nMatchingItems++;
                }
            }
]]>
</codefragment>
</duplication>
<duplication lines="60" tokens="175">
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrClassWithoutComponent.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrComponentWithoutNode.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInstanceWithoutClassifier.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInterfaceWithoutComponent.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInsideElement.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceInsideElement.java"/>
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceWithoutClassifier.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutClassifier.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutComponent.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrWrongDepEnds.java"/>
<codefragment>
<![CDATA[
    public CrClassWithoutComponent() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
	    return NO_PROBLEM;
	}
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
	    return NO_PROBLEM;
	}
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
	    return false;
	}
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }

    /**
     * If there are classes that are not inside a component
     * the returned ListSet is not null. Then in the ListSet
     * are the UMLDeploymentDiagram and all FigClasses with no
     * enclosing FigComponent
     *
     * @param dd the deployment diagram
     * @return the set of effenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram dd) {
]]>
</codefragment>
</duplication>
<duplication lines="45" tokens="172">
<file line="112" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/ClAttributeCompartment.java"/>
<file line="92" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/ClClassName.java"/>
<codefragment>
<![CDATA[
	    int right = fr.x + fr.width - 6;
	    g.setColor(Color.red);
	    int i = left;
	    while (true) {
		g.drawLine(i, height, i + WAVE_LENGTH, height + WAVE_HEIGHT);
		i += WAVE_LENGTH;
		if (i >= right) {
		    break;
		}
		g.drawLine(i, height + WAVE_HEIGHT, i + WAVE_LENGTH, height);
		i += WAVE_LENGTH;
		if (i >= right) {
		    break;
		}
		g.drawLine(i, height, i + WAVE_LENGTH,
			   height + WAVE_HEIGHT / 2);
		i += WAVE_LENGTH;
		if (i >= right) {
		    break;
		}
		g.drawLine(i, height + WAVE_HEIGHT / 2, i + WAVE_LENGTH,
			   height);
		i += WAVE_LENGTH;
		if (i >= right) {
		    break;
		}
	    }
	    fig = null;
	}
    }

    /*
     * @see javax.swing.Icon#getIconWidth()
     */
    public int getIconWidth() { return 0; }

    /*
     * @see javax.swing.Icon#getIconHeight()
     */
    public int getIconHeight() { return 0; }

    /*
     * @see org.argouml.ui.Clarifier#hit(int, int)
     */
    public boolean hit(int x, int y) {
]]>
</codefragment>
</duplication>
<duplication lines="60" tokens="172">
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrClassWithoutComponent.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrCompInstanceWithoutNode.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrComponentInstanceWithoutClassifier.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrComponentWithoutNode.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInstanceWithoutClassifier.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrInterfaceWithoutComponent.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInsideElement.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceInsideElement.java"/>
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNodeInstanceWithoutClassifier.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutClassifier.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrObjectWithoutComponent.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrWrongDepEnds.java"/>
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrWrongLinkEnds.java"/>
<codefragment>
<![CDATA[
    public CrClassWithoutComponent() {
        setupHeadAndDesc();
	addSupportedDecision(UMLDecision.PATTERNS);
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
	if (!(dm instanceof UMLDeploymentDiagram)) {
	    return NO_PROBLEM;
	}
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	if (offs == null) {
	    return NO_PROBLEM;
	}
	return PROBLEM_FOUND;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) dm;
	ListSet offs = computeOffenders(dd);
	return new UMLToDoItem(this, offs, dsgr);
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
	if (!isActive()) {
	    return false;
	}
	ListSet offs = i.getOffenders();
	UMLDeploymentDiagram dd = (UMLDeploymentDiagram) offs.get(0);
	//if (!predicate(dm, dsgr)) return false;
	ListSet newOffs = computeOffenders(dd);
	boolean res = offs.equals(newOffs);
	return res;
    }

    /**
     * If there are classes that are not inside a component
     * the returned ListSet is not null. Then in the ListSet
     * are the UMLDeploymentDiagram and all FigClasses with no
     * enclosing FigComponent
     *
     * @param dd the deployment diagram
     * @return the set of effenders
     */
    public ListSet computeOffenders(UMLDeploymentDiagram dd) {
]]>
</codefragment>
</duplication>
<duplication lines="44" tokens="168">
<file line="113" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/ClAttributeCompartment.java"/>
<file line="93" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/ClClassName.java"/>
<file line="110" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/ClOperationCompartment.java"/>
<codefragment>
<![CDATA[
	    g.setColor(Color.red);
	    int i = left;
	    while (true) {
		g.drawLine(i, height, i + WAVE_LENGTH, height + WAVE_HEIGHT);
		i += WAVE_LENGTH;
		if (i >= right) {
		    break;
		}
		g.drawLine(i, height + WAVE_HEIGHT, i + WAVE_LENGTH, height);
		i += WAVE_LENGTH;
		if (i >= right) {
		    break;
		}
		g.drawLine(i, height, i + WAVE_LENGTH,
			   height + WAVE_HEIGHT / 2);
		i += WAVE_LENGTH;
		if (i >= right) {
		    break;
		}
		g.drawLine(i, height + WAVE_HEIGHT / 2, i + WAVE_LENGTH,
			   height);
		i += WAVE_LENGTH;
		if (i >= right) {
		    break;
		}
	    }
	    fig = null;
	}
    }

    /*
     * @see javax.swing.Icon#getIconWidth()
     */
    public int getIconWidth() { return 0; }

    /*
     * @see javax.swing.Icon#getIconHeight()
     */
    public int getIconHeight() { return 0; }

    /*
     * @see org.argouml.ui.Clarifier#hit(int, int)
     */
    public boolean hit(int x, int y) {
]]>
</codefragment>
</duplication>
<duplication lines="30" tokens="167">
<file line="81" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepChoice.java"/>
<file line="70" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepCue.java"/>
<codefragment>
<![CDATA[
	instructions.setText(instr);
	instructions.setWrapStyleWord(true);
	instructions.setEditable(false);
	instructions.setBorder(null);
	instructions.setBackground(getMainPanel().getBackground());

	getMainPanel().setBorder(new EtchedBorder());

	GridBagLayout gb = new GridBagLayout();
	getMainPanel().setLayout(gb);

	GridBagConstraints c = new GridBagConstraints();
	c.ipadx = 3; c.ipady = 3;
	c.weightx = 0.0; c.weighty = 0.0;
	c.anchor = GridBagConstraints.EAST;

	JLabel image = new JLabel("");
	//image.setMargin(new Insets(0, 0, 0, 0));
	image.setIcon(getWizardIcon());
	image.setBorder(null);
	c.gridx = 0;
	c.gridheight = GridBagConstraints.REMAINDER;
	c.gridy = 0;
	c.anchor = GridBagConstraints.NORTH;
	gb.setConstraints(image, c);
	getMainPanel().add(image);

	c.weightx = 1.0;
	c.gridx = 2;
	c.gridheight = 1;
]]>
</codefragment>
</duplication>
<duplication lines="29" tokens="163">
<file line="76" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByDecision.java"/>
<file line="113" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByDecision.java"/>
<codefragment>
<![CDATA[
        LOG.log(Level.FINE, "toDoItemChanged");
        List<ToDoItem> items = tde.getToDoItemList();
	Object[] path = new Object[2];
	path[0] = Designer.theDesigner().getToDoList();

        for (Decision dec : Designer.theDesigner().getDecisionModel()
                .getDecisionList()) {
	    int nMatchingItems = 0;
	    path[1] = dec;
	    for (ToDoItem item : items) {
		if (!item.supports(dec)) {
                    continue;
                }
		nMatchingItems++;
	    }
	    if (nMatchingItems == 0) {
                continue;
            }
	    int[] childIndices = new int[nMatchingItems];
	    Object[] children = new Object[nMatchingItems];
	    nMatchingItems = 0;
            for (ToDoItem item : items) {
		if (!item.supports(dec)) {
                    continue;
                }
		childIndices[nMatchingItems] = getIndexOfChild(dec, item);
		children[nMatchingItems] = item;
		nMatchingItems++;
	    }
]]>
</codefragment>
</duplication>
<duplication lines="29" tokens="163">
<file line="76" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByType.java"/>
<file line="113" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByType.java"/>
<codefragment>
<![CDATA[
        LOG.log(Level.FINE, "toDoItemsChanged");
        List<ToDoItem> items = tde.getToDoItemList();
	Object[] path = new Object[2];
	path[0] = Designer.theDesigner().getToDoList();

        for (KnowledgeTypeNode ktn : KnowledgeTypeNode.getTypeList()) {
	    String kt = ktn.getName();
	    path[1] = ktn;
	    int nMatchingItems = 0;
            for (ToDoItem item : items) {
		if (!item.containsKnowledgeType(kt)) {
                    continue;
                }
		nMatchingItems++;
	    }
	    if (nMatchingItems == 0) {
                continue;
            }
	    int[] childIndices = new int[nMatchingItems];
	    Object[] children = new Object[nMatchingItems];
	    nMatchingItems = 0;
            for (ToDoItem item : items) {
		if (!item.containsKnowledgeType(kt)) {
                    continue;
                }
		childIndices[nMatchingItems] = getIndexOfChild(ktn, item);
		children[nMatchingItems] = item;
		nMatchingItems++;
	    }
]]>
</codefragment>
</duplication>
<duplication lines="38" tokens="161">
<file line="106" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleInitialStates.java"/>
<file line="108" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleShallowHistoryStates.java"/>
<codefragment>
<![CDATA[
                	        Model.getPseudostateKind().getInitial())) {
                initialStateCount++;
            }
        }
        if (initialStateCount > 1) {
            return PROBLEM_FOUND;
        }
        return NO_PROBLEM;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
        ListSet offs = computeOffenders(dm);
        return new UMLToDoItem(this, offs, dsgr);
    }

    /**
     * @param ps the object to check
     * @return the list of offenders
     */
    protected ListSet computeOffenders(Object ps) {
        ListSet offs = new ListSet(ps);
        Object cs = Model.getFacade().getContainer(ps);
        if (cs == null) {
            LOG.log(Level.FINE, "null parent in still valid");
            return offs;
	}

        Collection peers = Model.getFacade().getSubvertices(cs);
        for (Object sv : peers) {
            if (Model.getFacade().isAPseudostate(sv)
                && Model.getFacade().equalsPseudostateKind(
                        Model.getFacade().getKind(sv),
                        Model.getPseudostateKind().getInitial())) {
]]>
</codefragment>
</duplication>
<duplication lines="27" tokens="156">
<file line="76" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByGoal.java"/>
<file line="111" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/ToDoByGoal.java"/>
<codefragment>
<![CDATA[
        LOG.log(Level.FINE, "toDoItemsChanged");
	Object[] path = new Object[2];
	path[0] = Designer.theDesigner().getToDoList();

        for (Goal g : Designer.theDesigner().getGoalList()) {
	    path[1] = g;
	    int nMatchingItems = 0;
            for (ToDoItem item : tde.getToDoItemList()) {
		if (!item.supports(g)) {
                    continue;
                }
		nMatchingItems++;
	    }
	    if (nMatchingItems == 0) {
	        continue;
	    }
	    int[] childIndices = new int[nMatchingItems];
	    Object[] children = new Object[nMatchingItems];
	    nMatchingItems = 0;
            for (ToDoItem item : tde.getToDoItemList()) {
		if (!item.supports(g)) {
                    continue;
                }
		childIndices[nMatchingItems] = getIndexOfChild(g, item);
		children[nMatchingItems] = item;
		nMatchingItems++;
	    }
]]>
</codefragment>
</duplication>
<duplication lines="57" tokens="155">
<file line="433" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/activity/ui/UMLActivityDiagram.java"/>
<file line="503" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/UMLStateDiagram.java"/>
<codefragment>
<![CDATA[
    }
    /**
     * @return Returns the actionFinalPseudoState.
     */
    protected Action getActionFinalPseudoState() {
        if (actionFinalPseudoState == null) {
            actionFinalPseudoState =
                new RadioAction(
                        new CmdCreateNode(
                                Model.getMetaTypes().getFinalState(),
                        	"button.new-finalstate"));
        }
        return actionFinalPseudoState;
    }
    /**
     * @return Returns the actionForkPseudoState.
     */
    protected Action getActionForkPseudoState() {
        if (actionForkPseudoState == null) {
            actionForkPseudoState =
                new RadioAction(
                        new ActionCreatePseudostate(
                                Model.getPseudostateKind().getFork(),
                        	"button.new-fork"));
        }
        return actionForkPseudoState;
    }
    /**
     * @return Returns the actionJoinPseudoState.
     */
    protected Action getActionJoinPseudoState() {
        if (actionJoinPseudoState == null) {
            actionJoinPseudoState =
                new RadioAction(
                        new ActionCreatePseudostate(
                                Model.getPseudostateKind().getJoin(),
                        	"button.new-join"));
        }
        return actionJoinPseudoState;
    }
    /**
     * @return Returns the actionJunctionPseudoState.
     */
    protected Action getActionJunctionPseudoState() {
        if (actionJunctionPseudoState == null) {
            actionJunctionPseudoState =
                new RadioAction(
                        new ActionCreatePseudostate(
                                Model.getPseudostateKind().getJunction(),
                                "button.new-junction"));
        }
        return actionJunctionPseudoState;
    }
    /**
     * @return Returns the actionSwimlane.
     */
    protected Action getActionSwimlane() {
]]>
</codefragment>
</duplication>
<duplication lines="27" tokens="153">
<file line="82" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepChoice.java"/>
<file line="71" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepCue.java"/>
<file line="79" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepManyTextFields.java"/>
<codefragment>
<![CDATA[
	instructions.setWrapStyleWord(true);
	instructions.setEditable(false);
	instructions.setBorder(null);
	instructions.setBackground(getMainPanel().getBackground());

	getMainPanel().setBorder(new EtchedBorder());

	GridBagLayout gb = new GridBagLayout();
	getMainPanel().setLayout(gb);

	GridBagConstraints c = new GridBagConstraints();
	c.ipadx = 3; c.ipady = 3;
	c.weightx = 0.0; c.weighty = 0.0;
	c.anchor = GridBagConstraints.EAST;

	JLabel image = new JLabel("");
	//image.setMargin(new Insets(0, 0, 0, 0));
	image.setIcon(getWizardIcon());
	image.setBorder(null);
	c.gridx = 0;
	c.gridheight = GridBagConstraints.REMAINDER;
	c.gridy = 0;
	c.anchor = GridBagConstraints.NORTH;
	gb.setConstraints(image, c);
	getMainPanel().add(image);

	c.weightx = 1.0;
]]>
</codefragment>
</duplication>
<duplication lines="23" tokens="153">
<file line="1065" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/NotationUtilityUml.java"/>
<file line="712" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/TransitionNotationUml.java"/>
<codefragment>
<![CDATA[
    static String generateParameter(Object parameter) {
        StringBuffer s = new StringBuffer();
        s.append(generateKind(Model.getFacade().getKind(parameter)));
        if (s.length() > 0) {
            s.append(" ");
        }
        s.append(Model.getFacade().getName(parameter));
        String classRef =
            generateClassifierRef(Model.getFacade().getType(parameter));
        if (classRef.length() > 0) {
            s.append(" : ");
            s.append(classRef);
        }
        String defaultValue =
            generateExpression(Model.getFacade().getDefaultValue(parameter));
        if (defaultValue.length() > 0) {
            s.append(" = ");
            s.append(defaultValue);
        }
        return s.toString();
    }

    private static String generateExpression(Object expr) {
]]>
</codefragment>
</duplication>
<duplication lines="20" tokens="153">
<file line="311" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/persistence/PGMLStackParser.java"/>
<file line="194" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/UmlDiagramRenderer.java"/>
<codefragment>
<![CDATA[
            final String value = entry.getValue();

            if (fig instanceof FigCompartmentBox) {
                FigCompartmentBox fcb = (FigCompartmentBox) fig;
                if ("operationsVisible".equals(name)) {
                    fcb.showCompartment(Model.getMetaTypes().getOperation(),
                            value.equalsIgnoreCase("true"));
                } else if ("attributesVisible".equals(name)) {
                    fcb.showCompartment(Model.getMetaTypes().getAttribute(),
                            value.equalsIgnoreCase("true"));
                } else if ("enumerationLiteralsVisible".equals(name)) {
                    fcb.showCompartment(Model.getMetaTypes()
                            .getEnumerationLiteral(), value
                            .equalsIgnoreCase("true"));
                } else if ("extensionPointVisible".equals(name)) {
                    fcb.showCompartment(Model.getMetaTypes()
                            .getExtensionPoint(), value
                            .equalsIgnoreCase("true"));
                }
            }
]]>
</codefragment>
</duplication>
<duplication lines="31" tokens="153">
<file line="162" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigDataType.java"/>
<file line="132" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigInterface.java"/>
<codefragment>
<![CDATA[
        if (!(Model.getFacade().isAUMLElement(getOwner()))) {
            return;
        }
        /* If this fig is not visible, do not adapt the UML model!
         * This is used for deleting. See issue 3042.
         */
        if  (!isVisible()) {
            return;
        }
        Object me = getOwner();
        Object m = null;

        try {
            // If moved into an Package
            if (encloser != null
                    && oldEncloser != encloser
                    && Model.getFacade().isAPackage(encloser.getOwner())) {
                Model.getCoreHelper().setNamespace(me, encloser.getOwner());
            }

            // If default Namespace is not already set
            if (Model.getFacade().getNamespace(me) == null
                    && (TargetManager.getInstance().getTarget()
                    instanceof ArgoDiagram)) {
                m =
                    ((ArgoDiagram) TargetManager.getInstance().getTarget())
                        .getNamespace();
                Model.getCoreHelper().setNamespace(me, m);
            }
        } catch (Exception e) {
            LOG.log(Level.SEVERE,
]]>
</codefragment>
</duplication>
<duplication lines="24" tokens="152">
<file line="500" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigEdgeModelElement.java"/>
<file line="524" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigEdgeModelElement.java"/>
<codefragment>
<![CDATA[
        List<ToDoItem> items = tdList.elementListForOffender(getOwner());
        for (ToDoItem item : items) {
            Icon icon = item.getClarifier();
            stuffPointAlongPerimeter(iconPos, p);
            int width = icon.getIconWidth();
            int height = icon.getIconHeight();
            if (y >= p.y + yOff
                && y <= p.y + height + yOff
                && x >= p.x + xOff
                && x <= p.x + width + xOff) {
                return item;
            }
            iconPos += width;
        }
        for (ToDoItem item : items) {
            Icon icon = item.getClarifier();
            if (icon instanceof Clarifier) {
                ((Clarifier) icon).setFig(this);
                ((Clarifier) icon).setToDoItem(item);
                if (((Clarifier) icon).hit(x, y)) {
                    return item;
                }
            }
        }
]]>
</codefragment>
</duplication>
<duplication lines="93" tokens="151">
<file line="116" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigBranchState.java"/>
<file line="106" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJunctionState.java"/>
<codefragment>
<![CDATA[
        figClone.head = (FigCircle) it.next();
        return figClone;
    }


    /**
     * Choice states are fixed size.
     *
     * @return false
     */
    @Override
    public boolean isResizable() {
        return false;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has a fixed rendering.
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }

    ////////////////////////////////////////////////////////////////
    // Event handlers

    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
    public void mouseClicked(MouseEvent me) {
        // ignored
    }

    /**
     * Override setStandardBounds to keep shapes looking right.
     * {@inheritDoc}
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="49" tokens="151">
<file line="216" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/reveng/ConfigPanelExtension.java"/>
<file line="736" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/reveng/Import.java"/>
<codefragment>
<![CDATA[
        configPanel.add(listLabel,
                createGridBagConstraintsFinal());

        // TODO: Get the list of extended settings from the current
        // language importer and add those too
    }


    /**
     * Create a GridBagConstraints object to use with the layout.
     * 
     * @param topInset true to use a top inset 
     * @param bottomInset true to use a bottom inset
     * @param fill true to fill (horizontally)
     * @return the grid bag constraints
     */
    private GridBagConstraints createGridBagConstraints(boolean topInset,
            boolean bottomInset, boolean fill) {
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.gridx = GridBagConstraints.RELATIVE;
        gbc.gridy = GridBagConstraints.RELATIVE;
        gbc.gridwidth = GridBagConstraints.REMAINDER;
        gbc.gridheight = 1;
        gbc.weightx = 1.0;
        gbc.weighty = 0.0;
        gbc.anchor = GridBagConstraints.NORTHWEST;
        gbc.fill = fill ? GridBagConstraints.HORIZONTAL
                : GridBagConstraints.NONE;
        gbc.insets = 
            new Insets(
                    topInset ? 5 : 0, 
                    5, 
                    bottomInset ? 5 : 0, 
                    5);
        gbc.ipadx = 0;
        gbc.ipady = 0;
        return gbc;
    }

    /**
     * A GridBagConstraints for the last item to take up the rest of the space.
     * @return the GridBagConstraints object
     */
    private GridBagConstraints createGridBagConstraintsFinal() {
        GridBagConstraints gbc = createGridBagConstraints(false, true, false);
        gbc.gridheight = GridBagConstraints.REMAINDER;
        gbc.weighty = 1.0;
        return gbc;
    }
]]>
</codefragment>
</duplication>
<duplication lines="39" tokens="149">
<file line="249" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/collaboration/CollabDiagramGraphModel.java"/>
<file line="252" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/DeploymentDiagramGraphModel.java"/>
<codefragment>
<![CDATA[
	    end1 = suppliers.iterator().next();
	} else if (edge instanceof CommentEdge) {
	    end0 = ((CommentEdge) edge).getSource();
	    end1 = ((CommentEdge) edge).getDestination();
	} else {
	    return false;
        }

        // Both ends must be defined and nodes that are on the graph already.
        if (end0 == null || end1 == null) {
            LOG.log(Level.SEVERE, "Edge rejected. Its ends are not attached to anything");
            return false;
        }

        if (!containsNode(end0)
                && !containsEdge(end0)) {
            LOG.log(Level.SEVERE, "Edge rejected. Its source end is attached to " + end0
                    + " but this is not in the graph model");
            return false;
        }
        if (!containsNode(end1)
                && !containsEdge(end1)) {
            LOG.log(Level.SEVERE, "Edge rejected. Its destination end is attached to "
                    + end1 + " but this is not in the graph model");
            return false;
        }

        return true;
    }


    /*
     * Add the given node to the graph, if valid.
     *
     * @see org.tigris.gef.graph.MutableGraphModel#addNode(java.lang.Object)
     */
    @Override
    public void addNode(Object node) {
  LOG.log(Level.FINE, "adding MClassifierRole node!!");
]]>
</codefragment>
</duplication>
<duplication lines="87" tokens="149">
<file line="116" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigBranchState.java"/>
<file line="156" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigHistoryState.java"/>
<file line="106" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJunctionState.java"/>
<codefragment>
<![CDATA[
        figClone.head = (FigCircle) it.next();
        return figClone;
    }


    /**
     * Choice states are fixed size.
     *
     * @return false
     */
    @Override
    public boolean isResizable() {
        return false;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has a fixed rendering.
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }

    ////////////////////////////////////////////////////////////////
    // Event handlers

    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
    public void mouseClicked(MouseEvent me) {
        // ignored
    }
]]>
</codefragment>
</duplication>
<duplication lines="33" tokens="149">
<file line="345" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/TabStereotype.java"/>
<file line="216" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/UMLModelElementListModel2.java"/>
<file line="213" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/UMLStereotypeListModel.java"/>
<codefragment>
<![CDATA[
            } else if (e instanceof AddAssociationEvent) {
                //Remove the element from Available List
                boolean valid = false;
                if (!(getChangedElement(e) instanceof Collection)) {
                    valid = contains(getChangedElement(e));
                } else {
                    Collection col = (Collection) getChangedElement(e);
                    Iterator it = col.iterator();
                    valid = true;
                    while (it.hasNext()) {
                        Object o = it.next();
                        if (!contains(o)) {
                            valid = false;
                            break;
                        }
                    }
                }
                if (valid) {
                    Object o = getChangedElement(e);
                    if (o instanceof Collection) {
                        Iterator it = ((Collection) o).iterator();
                        while (it.hasNext()) {
                            Object o3 = it.next();
                            removeElement(o3);
                        }
                    } else {
                        removeElement(o);
                    }
                }
                
               
                
            } else if (e instanceof RemoveAssociationEvent) {
]]>
</codefragment>
</duplication>
<duplication lines="49" tokens="148">
<file line="61" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigCircle.java"/>
<file line="61" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigRRect.java"/>
<file line="61" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigRect.java"/>
<codefragment>
<![CDATA[
    public ArgoFigCircle(int x, int y, int w, int h) {
        super(x, y, w, h);
    }


    /*
     * @see org.tigris.gef.presentation.Fig#deleteFromModel()
     */
    @Override
    public void deleteFromModel() {
        super.deleteFromModel();
        firePropChange("remove", null, null);
        notifier.sendNotification(new Notification("remove", this, 0));
    }

    /*
     * @see javax.management.NotificationEmitter#removeNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)
     */
    public void removeNotificationListener(NotificationListener listener,
        NotificationFilter filter, Object handback) 
        throws ListenerNotFoundException {
        notifier.removeNotificationListener(listener, filter, handback);
    }

    /*
     * @see javax.management.NotificationBroadcaster#addNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)
     */
    public void addNotificationListener(NotificationListener listener, 
        NotificationFilter filter, Object handback) 
        throws IllegalArgumentException {
        notifier.addNotificationListener(listener, filter, handback);
    }

    /*
     * @see javax.management.NotificationBroadcaster#getNotificationInfo()
     */
    public MBeanNotificationInfo[] getNotificationInfo() {
        return notifier.getNotificationInfo();
    }

    /*
     * @see javax.management.NotificationBroadcaster#removeNotificationListener(javax.management.NotificationListener)
     */
    public void removeNotificationListener(NotificationListener listener) 
        throws ListenerNotFoundException {
        notifier.removeNotificationListener(listener);
    }

}
]]>
</codefragment>
</duplication>
<duplication lines="87" tokens="147">
<file line="158" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigHistoryState.java"/>
<file line="137" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigInitialState.java"/>
<codefragment>
<![CDATA[
    }


    /**
     * History states are fixed size.
     * @return false
     */
    @Override
    public boolean isResizable() {
        return false;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has fixed rendering
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }


    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
    public void mouseClicked(MouseEvent me) {
        // ignored
    }

    /**
     * The UID.
     */
    static final long serialVersionUID = 6572261327347541373L;
]]>
</codefragment>
</duplication>
<duplication lines="27" tokens="146">
<file line="64" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/ButtonActionNewEffect.java"/>
<file line="66" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/ButtonActionNewEvent.java"/>
<codefragment>
<![CDATA[
        putValue(SMALL_ICON, icon);
//        TargetManager.getInstance().addTargetListener(this);
    }

    public void actionPerformed(ActionEvent e) {
        if (!isEnabled()) {
            return;
        }
        super.actionPerformed(e);
        Object target = TargetManager.getInstance().getModelTarget();
        Object model = Model.getFacade().getInnerContainingModel(target);
        Object ns = Model.getStateMachinesHelper()
                    .findNamespaceForEvent(target, model);
        Object event = createEvent(ns);
        Model.getStateMachinesHelper().setEventAsTrigger(target, event);
        TargetManager.getInstance().setTarget(event);
    }

    public boolean isEnabled() {
        Object target = TargetManager.getInstance().getModelTarget();
        return Model.getFacade().isATransition(target);
    }
    
    protected abstract Object createEvent(Object ns);
    
    protected abstract String getKeyName();
    protected abstract String getIconName();
]]>
</codefragment>
</duplication>
<duplication lines="81" tokens="143">
<file line="156" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigHistoryState.java"/>
<file line="144" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigSynchState.java"/>
<codefragment>
<![CDATA[
        figClone.h = (FigText) it.next();
        return figClone;
    }


    /**
     * History states are fixed size.
     * @return false
     */
    @Override
    public boolean isResizable() {
        return false;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has fixed rendering
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }


    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="85" tokens="141">
<file line="118" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigBranchState.java"/>
<file line="137" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigInitialState.java"/>
<file line="108" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJunctionState.java"/>
<codefragment>
<![CDATA[
    }


    /**
     * Choice states are fixed size.
     *
     * @return false
     */
    @Override
    public boolean isResizable() {
        return false;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has a fixed rendering.
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }

    ////////////////////////////////////////////////////////////////
    // Event handlers

    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
    public void mouseClicked(MouseEvent me) {
        // ignored
    }
]]>
</codefragment>
</duplication>
<duplication lines="84" tokens="140">
<file line="116" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigBranchState.java"/>
<file line="106" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJunctionState.java"/>
<file line="144" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigSynchState.java"/>
<codefragment>
<![CDATA[
        figClone.head = (FigCircle) it.next();
        return figClone;
    }


    /**
     * Choice states are fixed size.
     *
     * @return false
     */
    @Override
    public boolean isResizable() {
        return false;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has a fixed rendering.
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }

    ////////////////////////////////////////////////////////////////
    // Event handlers

    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="26" tokens="139">
<file line="1041" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigPackage.java"/>
<file line="1136" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigPackage.java"/>
<codefragment>
<![CDATA[
        }

        /*
         * @see org.tigris.gef.presentation.Fig#getClosestPoint(java.awt.Point)
         */
        @Override
        public Point getClosestPoint(Point anotherPt) {
            Rectangle r = getBounds();
            int[] xs = {
                r.x, r.x + r.width - indentX, r.x + r.width - indentX,
                r.x + r.width,   r.x + r.width,  r.x,            r.x,
            };
            int[] ys = {
                r.y, r.y,                     r.y + tabHeight,
                r.y + tabHeight, r.y + r.height, r.y + r.height, r.y,
            };
            Point p =
                Geometry.ptClosestTo(
                    xs,
                    ys,
                    7,
                    anotherPt);
            return p;
        };

        public void setBoundsImpl(
]]>
</codefragment>
</duplication>
<duplication lines="49" tokens="138">
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigInk.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigPoly.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigSpline.java"/>
<codefragment>
<![CDATA[
    public ArgoFigInk(int x, int y) {
        super(x, y);
    }


    /*
     * @see org.tigris.gef.presentation.Fig#deleteFromModel()
     */
    @Override
    public void deleteFromModel() {
        super.deleteFromModel();
        firePropChange("remove", null, null);
        notifier.sendNotification(new Notification("remove", this, 0));
    }

    /*
     * @see javax.management.NotificationEmitter#removeNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)
     */
    public void removeNotificationListener(NotificationListener listener,
        NotificationFilter filter, Object handback) 
        throws ListenerNotFoundException {
        notifier.removeNotificationListener(listener, filter, handback);
    }

    /*
     * @see javax.management.NotificationBroadcaster#addNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)
     */
    public void addNotificationListener(NotificationListener listener, 
        NotificationFilter filter, Object handback) 
        throws IllegalArgumentException {
        notifier.addNotificationListener(listener, filter, handback);
    }

    /*
     * @see javax.management.NotificationBroadcaster#getNotificationInfo()
     */
    public MBeanNotificationInfo[] getNotificationInfo() {
        return notifier.getNotificationInfo();
    }

    /*
     * @see javax.management.NotificationBroadcaster#removeNotificationListener(javax.management.NotificationListener)
     */
    public void removeNotificationListener(NotificationListener listener) 
        throws ListenerNotFoundException {
        notifier.removeNotificationListener(listener);
    }

}
]]>
</codefragment>
</duplication>
<duplication lines="24" tokens="137">
<file line="829" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigPackage.java"/>
<file line="1041" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigPackage.java"/>
<file line="1136" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigPackage.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getClosestPoint(java.awt.Point)
     */
    @Override
    public Point getClosestPoint(Point anotherPt) {
        Rectangle r = getBounds();
        int[] xs = {
            r.x, r.x + r.width - indentX, r.x + r.width - indentX,
            r.x + r.width,   r.x + r.width,  r.x,            r.x,
        };
        int[] ys = {
            r.y, r.y,                     r.y + tabHeight,
            r.y + tabHeight, r.y + r.height, r.y + r.height, r.y,
        };
        Point p =
            Geometry.ptClosestTo(
                xs,
                ys,
                7,
                anotherPt);
        return p;
    }
]]>
</codefragment>
</duplication>
<duplication lines="75" tokens="135">
<file line="124" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigForkState.java"/>
<file line="168" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigHistoryState.java"/>
<file line="147" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigInitialState.java"/>
<file line="124" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJoinState.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        // noop - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }
   
    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
    public void mouseClicked(MouseEvent me) {
        // ignored
    }

    /**
     * The UID.
     */
    static final long serialVersionUID = 6702818473439087473L;
]]>
</codefragment>
</duplication>
<duplication lines="20" tokens="134">
<file line="582" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/AbstractMessageNotationUml.java"/>
<file line="619" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/AbstractMessageNotationUml.java"/>
<codefragment>
<![CDATA[
                    mustBeSeq = true;

                    if (currentseq.size() > 2
                            && currentseq.get(currentseq.size() - 2) == null
                            && currentseq.get(currentseq.size() - 1) == null) {
                        currentseq.remove(currentseq.size() - 1);
                        currentseq.remove(currentseq.size() - 1);
                    }

                    if (currentseq.get(currentseq.size() - 2) != null
                            || currentseq.get(currentseq.size() - 1) != null) {

                        predecessors.add(currentseq);

                        currentseq = new ArrayList<Integer>();
                        currentseq.add(null);
                        currentseq.add(null);
                    }
                    hasPredecessors = true;
                } else if ("//".equals(token)) {
]]>
</codefragment>
</duplication>
<duplication lines="17" tokens="134">
<file line="254" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/ActionAggregation.java"/>
<file line="106" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/ActionMultiplicity.java"/>
<codefragment>
<![CDATA[
    public void oldActionPerformed(ActionEvent ae) {
        super.actionPerformed(ae);
        List sels = Globals.curEditor().getSelectionManager().selections();
        if (sels.size() == 1) {
            Selection sel = (Selection) sels.get(0);
            Fig f = sel.getContent();
            Object owner = ((FigEdgeModelElement) f).getOwner();
            Collection ascEnds = Model.getFacade().getConnections(owner);
            Iterator iter = ascEnds.iterator();
            Object ascEnd = null;
            if (str.equals("src")) {
                ascEnd = iter.next();
            } else {
                while (iter.hasNext()) {
                    ascEnd = iter.next();
                }
            }
]]>
</codefragment>
</duplication>
<duplication lines="68" tokens="133">
<file line="196" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/activity/ui/FigActionState.java"/>
<file line="302" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/activity/ui/FigObjectFlowState.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        cover.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return cover.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        cover.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return cover.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        cover.setFilled(f);
    }

    @Override
    public boolean isFilled() {
        return cover.isFilled();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        cover.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return cover.getLineWidth();
    }

    /*
     * @see org.argouml.uml.diagram.ui.FigNodeModelElement#modelChanged(java.beans.PropertyChangeEvent)
     */
    @Override
    protected void modelChanged(PropertyChangeEvent mee) {
]]>
</codefragment>
</duplication>
<duplication lines="31" tokens="133">
<file line="252" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/DeploymentDiagramGraphModel.java"/>
<file line="202" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/StateDiagramGraphModel.java"/>
<codefragment>
<![CDATA[
                    Model.getCommonBehaviorHelper().getDestination(edge);
        } else if (edge instanceof CommentEdge) {
            end0 = ((CommentEdge) edge).getSource();
            end1 = ((CommentEdge) edge).getDestination();
        } else {
            return false;
        }

        // Both ends must be defined and nodes that are on the graph already.
        if (end0 == null || end1 == null) {
            LOG.log(Level.SEVERE, "Edge rejected. Its ends are not attached to anything");
            return false;
        }

        if (!containsNode(end0)
                && !containsEdge(end0)) {
            LOG.log(Level.SEVERE, "Edge rejected. Its source end is attached to "
                    + end0
                    + " but this is not in the graph model");
            return false;
        }
        if (!containsNode(end1)
                && !containsEdge(end1)) {
            LOG.log(Level.SEVERE, "Edge rejected. Its destination end is attached to "
                    + end1
                    + " but this is not in the graph model");
            return false;
        }

        return true;
    }
]]>
</codefragment>
</duplication>
<duplication lines="68" tokens="132">
<file line="195" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/activity/ui/FigActionState.java"/>
<file line="226" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/collaboration/ui/FigClassifierRole.java"/>
<codefragment>
<![CDATA[
        firePropChange("bounds", oldBounds, getBounds());
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        cover.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return cover.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        cover.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return cover.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        cover.setFilled(f);
    }

    @Override
    public boolean isFilled() {
        return cover.isFilled();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        cover.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return cover.getLineWidth();
    }

    /*
     * @see org.argouml.uml.diagram.ui.FigNodeModelElement#modelChanged(java.beans.PropertyChangeEvent)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="76" tokens="132">
<file line="227" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/collaboration/ui/FigClassifierRole.java"/>
<file line="117" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/ui/FigObject.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        cover.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return cover.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        cover.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return cover.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        cover.setFilled(f);
    }


    @Override
    public boolean isFilled() {
        return cover.isFilled();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        cover.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return cover.getLineWidth();
    }


    /**
     * Work out the minimum size that this Fig can be.<p>
     *
     * This should be the size of the stereotype + name + padding. However
     * we allow for the possible case that the cover or big port could be
     * bigger still.<p>
     *
     * @return  The minimum size of this fig.
     */
    @Override
    public Dimension getMinimumSize() {
]]>
</codefragment>
</duplication>
<duplication lines="79" tokens="132">
<file line="137" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigInitialState.java"/>
<file line="146" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigSynchState.java"/>
<codefragment>
<![CDATA[
    }

    /**
     * Initial states are fixed size.
     *
     * @return false
     */
    @Override
    public boolean isResizable() {
        return false;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has fixed rendering
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored - rendering is fixed
    }


    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }

    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="67" tokens="131">
<file line="302" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/activity/ui/FigObjectFlowState.java"/>
<file line="227" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/collaboration/ui/FigClassifierRole.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        cover.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return cover.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        cover.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return cover.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        cover.setFilled(f);
    }

    @Override
    public boolean isFilled() {
        return cover.isFilled();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        cover.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return cover.getLineWidth();
    }

    /*
     * @see org.argouml.uml.diagram.ui.FigNodeModelElement#textEdited(org.tigris.gef.presentation.FigText)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="67" tokens="131">
<file line="196" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/activity/ui/FigActionState.java"/>
<file line="117" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/ui/FigObject.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        cover.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return cover.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        cover.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return cover.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        cover.setFilled(f);
    }

    @Override
    public boolean isFilled() {
        return cover.isFilled();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        cover.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return cover.getLineWidth();
    }

    /*
     * @see org.argouml.uml.diagram.ui.FigNodeModelElement#modelChanged(java.beans.PropertyChangeEvent)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="29" tokens="131">
<file line="249" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/collaboration/CollabDiagramGraphModel.java"/>
<file line="202" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/StateDiagramGraphModel.java"/>
<codefragment>
<![CDATA[
	    end1 = suppliers.iterator().next();
	} else if (edge instanceof CommentEdge) {
	    end0 = ((CommentEdge) edge).getSource();
	    end1 = ((CommentEdge) edge).getDestination();
	} else {
	    return false;
        }

        // Both ends must be defined and nodes that are on the graph already.
        if (end0 == null || end1 == null) {
            LOG.log(Level.SEVERE, "Edge rejected. Its ends are not attached to anything");
            return false;
        }

        if (!containsNode(end0)
                && !containsEdge(end0)) {
            LOG.log(Level.SEVERE, "Edge rejected. Its source end is attached to " + end0
                    + " but this is not in the graph model");
            return false;
        }
        if (!containsNode(end1)
                && !containsEdge(end1)) {
            LOG.log(Level.SEVERE, "Edge rejected. Its destination end is attached to "
                    + end1 + " but this is not in the graph model");
            return false;
        }

        return true;
    }
]]>
</codefragment>
</duplication>
<duplication lines="34" tokens="130">
<file line="72" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrAssocNameConflict.java"/>
<file line="75" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNameConflict.java"/>
<codefragment>
<![CDATA[
        setKnowledgeTypes(Critic.KT_SYNTAX);
        // no good trigger
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#predicate2(
     *      java.lang.Object, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
        return computeOffenders(dm).size() > 1;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem( java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
        ListSet offs = computeOffenders(dm);
        return new UMLToDoItem(this, offs, dsgr);
    }

    /**
     * @param dm
     *            the object to check
     * @return the set of offenders
     */
    protected ListSet computeOffenders(Object dm) {
        ListSet offenderResult = new ListSet();
        if (Model.getFacade().isANamespace(dm)) {
            HashMap<String, Object> names = new HashMap<String, Object>();
            for (Object name1Object : Model.getFacade().getOwnedElements(dm)) {
                if (!Model.getFacade().isAAssociation(name1Object)) {
]]>
</codefragment>
</duplication>
<duplication lines="74" tokens="130">
<file line="129" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigBranchState.java"/>
<file line="124" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigForkState.java"/>
<file line="124" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJoinState.java"/>
<file line="118" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJunctionState.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has a fixed rendering.
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }

    ////////////////////////////////////////////////////////////////
    // Event handlers

    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
    public void mouseClicked(MouseEvent me) {
        // ignored
    }
]]>
</codefragment>
</duplication>
<duplication lines="22" tokens="128">
<file line="314" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/AttributeNotationUml.java"/>
<file line="399" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/OperationNotationUml.java"/>
<codefragment>
<![CDATA[
                    StringBuilder propname = new StringBuilder();
                    String propvalue = null;

                    if (properties == null) {
                        properties = new ArrayList<String>();
                    }
                    while (true) {
                        token = st.nextToken();
                        if (",".equals(token) || "}".equals(token)) {
                            if (propname.length() > 0) {
                                properties.add(propname.toString());
                                properties.add(propvalue);
                            }
                            propname = new StringBuilder();
                            propvalue = null;

                            if ("}".equals(token)) {
                                break;
                            }
                        } else if ("=".equals(token)) {
                            if (propvalue != null) {
                                String msg =
]]>
</codefragment>
</duplication>
<duplication lines="22" tokens="128">
<file line="985" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigNodeModelElement.java"/>
<file line="1007" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigNodeModelElement.java"/>
<codefragment>
<![CDATA[
        List<ToDoItem> items = tdList.elementListForOffender(getOwner());
        for (ToDoItem item : items) {
            Icon icon = item.getClarifier();
            int width = icon.getIconWidth();
            if (y >= getY() - 15
                    && y <= getY() + 10
                    && x >= iconX
                    && x <= iconX + width) {
                return item;
            }
            iconX += width;
        }
        for (ToDoItem item : items) {
            Icon icon = item.getClarifier();
            if (icon instanceof Clarifier) {
                ((Clarifier) icon).setFig(this);
                ((Clarifier) icon).setToDoItem(item);
                if (((Clarifier) icon).hit(x, y)) {
                    return item;
                }
            }
        }
]]>
</codefragment>
</duplication>
<duplication lines="48" tokens="125">
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigCircle.java"/>
<file line="66" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigInk.java"/>
<file line="80" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigLine.java"/>
<file line="66" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigPoly.java"/>
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigRRect.java"/>
<file line="62" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigRect.java"/>
<file line="66" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigSpline.java"/>
<codefragment>
<![CDATA[
        super(x, y, w, h);
    }


    /*
     * @see org.tigris.gef.presentation.Fig#deleteFromModel()
     */
    @Override
    public void deleteFromModel() {
        super.deleteFromModel();
        firePropChange("remove", null, null);
        notifier.sendNotification(new Notification("remove", this, 0));
    }

    /*
     * @see javax.management.NotificationEmitter#removeNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)
     */
    public void removeNotificationListener(NotificationListener listener,
        NotificationFilter filter, Object handback) 
        throws ListenerNotFoundException {
        notifier.removeNotificationListener(listener, filter, handback);
    }

    /*
     * @see javax.management.NotificationBroadcaster#addNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)
     */
    public void addNotificationListener(NotificationListener listener, 
        NotificationFilter filter, Object handback) 
        throws IllegalArgumentException {
        notifier.addNotificationListener(listener, filter, handback);
    }

    /*
     * @see javax.management.NotificationBroadcaster#getNotificationInfo()
     */
    public MBeanNotificationInfo[] getNotificationInfo() {
        return notifier.getNotificationInfo();
    }

    /*
     * @see javax.management.NotificationBroadcaster#removeNotificationListener(javax.management.NotificationListener)
     */
    public void removeNotificationListener(NotificationListener listener) 
        throws ListenerNotFoundException {
        notifier.removeNotificationListener(listener);
    }

}
]]>
</codefragment>
</duplication>
<duplication lines="37" tokens="124">
<file line="145" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleDeepHistoryStates.java"/>
<file line="144" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleShallowHistoryStates.java"/>
<codefragment>
<![CDATA[
                            Model.getPseudostateKind().getDeepHistory())) {
                offs.add(sv);
            }
        }
        return offs;
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
        if (!isActive()) {
            return false;
        }
        ListSet offs = i.getOffenders();
        Object dm = offs.get(0);
        ListSet newOffs = computeOffenders(dm);
        boolean res = offs.equals(newOffs);
        return res;
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#getCriticizedDesignMaterials()
     */
    @Override
    public Set<Object> getCriticizedDesignMaterials() {
        Set<Object> ret = new HashSet<Object>();
        ret.add(Model.getMetaTypes().getPseudostate());
        return ret;
    }

    /**
     * The UID.
     */
    private static final long serialVersionUID = -4893102976661022514L;
]]>
</codefragment>
</duplication>
<duplication lines="37" tokens="123">
<file line="145" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleDeepHistoryStates.java"/>
<file line="143" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleInitialStates.java"/>
<file line="144" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleShallowHistoryStates.java"/>
<codefragment>
<![CDATA[
                            Model.getPseudostateKind().getDeepHistory())) {
                offs.add(sv);
            }
        }
        return offs;
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
        if (!isActive()) {
            return false;
        }
        ListSet offs = i.getOffenders();
        Object dm = offs.get(0);
        ListSet newOffs = computeOffenders(dm);
        boolean res = offs.equals(newOffs);
        return res;
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#getCriticizedDesignMaterials()
     */
    @Override
    public Set<Object> getCriticizedDesignMaterials() {
        Set<Object> ret = new HashSet<Object>();
        ret.add(Model.getMetaTypes().getPseudostate());
        return ret;
    }

    /**
     * The UID.
     */
    private static final long serialVersionUID = -4893102976661022514L;
]]>
</codefragment>
</duplication>
<duplication lines="21" tokens="123">
<file line="212" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigEdgeNote.java"/>
<file line="239" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/FigEdgeNote.java"/>
<codefragment>
<![CDATA[
    public void setDestFigNode(FigNode fn) {
        // When this is called from PGMLStackParser.attachEdges, we finished
        // the initialization of owning pseudo element (CommentEdge)
        if (fn != null && Model.getFacade().isAComment(fn.getOwner())) {
            Object oldComment = comment;
            if (oldComment != null) {
                removeElementListener(oldComment);
            }
            comment = fn.getOwner();
            if (comment != null) {
                addElementListener(comment);
            }

            ((CommentEdge) getOwner()).setComment(comment);
        } else if (fn != null
                && !Model.getFacade().isAComment(fn.getOwner())) {
            annotatedElement = fn.getOwner();
            ((CommentEdge) getOwner()).setAnnotatedElement(annotatedElement);
        }

        super.setDestFigNode(fn);
]]>
</codefragment>
</duplication>
<duplication lines="45" tokens="123">
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigCircle.java"/>
<file line="67" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigInk.java"/>
<file line="81" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigLine.java"/>
<file line="67" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigPoly.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigRRect.java"/>
<file line="63" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigRect.java"/>
<file line="67" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/gefext/ArgoFigSpline.java"/>
<file line="109" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/ArgoFigText.java"/>
<codefragment>
<![CDATA[
    }


    /*
     * @see org.tigris.gef.presentation.Fig#deleteFromModel()
     */
    @Override
    public void deleteFromModel() {
        super.deleteFromModel();
        firePropChange("remove", null, null);
        notifier.sendNotification(new Notification("remove", this, 0));
    }

    /*
     * @see javax.management.NotificationEmitter#removeNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)
     */
    public void removeNotificationListener(NotificationListener listener,
        NotificationFilter filter, Object handback) 
        throws ListenerNotFoundException {
        notifier.removeNotificationListener(listener, filter, handback);
    }

    /*
     * @see javax.management.NotificationBroadcaster#addNotificationListener(javax.management.NotificationListener, javax.management.NotificationFilter, java.lang.Object)
     */
    public void addNotificationListener(NotificationListener listener, 
        NotificationFilter filter, Object handback) 
        throws IllegalArgumentException {
        notifier.addNotificationListener(listener, filter, handback);
    }

    /*
     * @see javax.management.NotificationBroadcaster#getNotificationInfo()
     */
    public MBeanNotificationInfo[] getNotificationInfo() {
        return notifier.getNotificationInfo();
    }

    /*
     * @see javax.management.NotificationBroadcaster#removeNotificationListener(javax.management.NotificationListener)
     */
    public void removeNotificationListener(NotificationListener listener) 
        throws ListenerNotFoundException {
        notifier.removeNotificationListener(listener);
    }
]]>
</codefragment>
</duplication>
<duplication lines="68" tokens="123">
<file line="157" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigSynchState.java"/>
<file line="217" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigNodeAssociation.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        // ignored
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }

    /*
     * @see org.argouml.uml.diagram.ui.FigNodeModelElement#modelChanged(java.beans.PropertyChangeEvent)
     */
    @Override
    protected void modelChanged(PropertyChangeEvent mee) {
]]>
</codefragment>
</duplication>
<duplication lines="55" tokens="123">
<file line="225" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/ui/UMLDeploymentDiagram.java"/>
<file line="286" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/use_case/ui/UMLUseCaseDiagram.java"/>
<codefragment>
<![CDATA[
    }

    //////////////////////////////
    // Getters for plugin modules:
    //////////////////////////////

    /**
     * @return Returns the actionAggregation.
     */
    protected Action getActionAggregation() {
        if (actionAggregation == null) {
            actionAggregation =
                new RadioAction(
                    new ActionSetAddAssociationMode(
                        Model.getAggregationKind().getAggregate(),
                        false,
                        "button.new-aggregation"));
        }
        return actionAggregation;
    }

    /**
     * @return Returns the actionAssociation.
     */
    protected Action getActionAssociation() {
        if (actionAssociation == null) {
            actionAssociation =
                new RadioAction(
                    new ActionSetAddAssociationMode(
                        Model.getAggregationKind().getNone(),
                        false,
                        "button.new-association"));
        }
        return actionAssociation;
    }

    /**
     * @return Returns the actionComposition.
     */
    protected Action getActionComposition() {
        if (actionComposition == null) {
            actionComposition =
                new RadioAction(
                    new ActionSetAddAssociationMode(
                        Model.getAggregationKind().getComposite(),
                        false,
                        "button.new-composition"));
        }
        return actionComposition;
    }

    /**
     * @return Returns the actionMAssociation.
     */
    protected Action getActionMAssociation() {
]]>
</codefragment>
</duplication>
<duplication lines="24" tokens="123">
<file line="75" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/ActionImportXMI.java"/>
<file line="95" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/ActionOpenProject.java"/>
<codefragment>
<![CDATA[
        ProjectBrowser pb = ProjectBrowser.getInstance();
        Project p = ProjectManager.getManager().getCurrentProject();
        PersistenceManager pm = PersistenceManager.getInstance();

        if (!ProjectBrowser.getInstance().askConfirmationAndSave()) {
            return;
        }

        JFileChooser chooser = null;
        if (p != null && p.getURI() != null) {
            File file = new File(p.getURI());
            if (file.getParentFile() != null) {
                chooser = new JFileChooser(file.getParent());
            }
        } else {
            chooser = new JFileChooser();
        }

        if (chooser == null) {
            chooser = new JFileChooser();
        }

        chooser.setDialogTitle(
                Translator.localize("filechooser.import-xmi"));
]]>
</codefragment>
</duplication>
<duplication lines="38" tokens="123">
<file line="305" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/TabStereotype.java"/>
<file line="441" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/UMLModelElementListModel2.java"/>
<file line="438" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/UMLStereotypeListModel.java"/>
<codefragment>
<![CDATA[
                if ((e.getNewValue() != null && e.getOldValue() == null) 
                        || isValidElement(getChangedElement(e))) {
                    valid = true; // we tried to remove a value
                }
            } else {
                Collection col = (Collection) getChangedElement(e);
                Iterator it = col.iterator();
                if (!col.isEmpty()) {
                    valid = true;
                    while (it.hasNext()) {
                        Object o = it.next();
                        if (!isValidElement(o)) {
                            valid = false;
                            break;
                        }
                    }
                } else {
                    if (e.getOldValue() instanceof Collection
                        && !((Collection) e.getOldValue()).isEmpty()) {
                        valid = true;
                    }
                }
            }
            return valid;
        }
        
        /**
         * Must be different from the extends class because 
         * when we add a sterotype=> remove from available
         *         remove a stereotype=> add to available
         * Called twices: with a AttributeChangeEvent, and with AddAssociationEvent or RemoveAssociationEvent
         * 
         * @param e
         * 
         * @see org.argouml.uml.ui.UMLStereotypeListModel#propertyChange(PropertyChangeEvent)
         * @since 20110215
         */
        public void propertyChange(PropertyChangeEvent e) {
]]>
</codefragment>
</duplication>
<duplication lines="68" tokens="122">
<file line="123" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigForkState.java"/>
<file line="123" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJoinState.java"/>
<file line="216" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigNodeAssociation.java"/>
<codefragment>
<![CDATA[
        firePropChange("bounds", oldBounds, getBounds());
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        // noop - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }
   
    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="23" tokens="121">
<file line="105" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepChoice.java"/>
<file line="93" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepTextField.java"/>
<codefragment>
<![CDATA[
	gb.setConstraints(image, c);
	getMainPanel().add(image);

	c.weightx = 1.0;
	c.gridx = 2;
	c.gridheight = 1;
	c.gridwidth = 3;
	c.gridy = 0;
	c.fill = GridBagConstraints.HORIZONTAL;
	gb.setConstraints(instructions, c);
	getMainPanel().add(instructions);

	c.gridx = 1;
	c.gridy = 1;
	c.weightx = 0.0;
	c.gridwidth = 1;
	c.fill = GridBagConstraints.NONE;
	SpacerPanel spacer = new SpacerPanel();
	gb.setConstraints(spacer, c);
	getMainPanel().add(spacer);

	c.gridx = 2;
	c.weightx = 1.0;
]]>
</codefragment>
</duplication>
<duplication lines="67" tokens="121">
<file line="124" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigForkState.java"/>
<file line="124" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJoinState.java"/>
<file line="157" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigSynchState.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        // noop - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }
   
    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="71" tokens="121">
<file line="129" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigBranchState.java"/>
<file line="168" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigHistoryState.java"/>
<file line="147" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigInitialState.java"/>
<file line="118" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigJunctionState.java"/>
<file line="217" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigNodeAssociation.java"/>
<codefragment>
<![CDATA[
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineColor(java.awt.Color)
     */
    @Override
    public void setLineColor(Color col) {
        head.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return head.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        head.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return head.getFillColor();
    }

    /**
     * Ignored - figure has a fixed rendering.
     * @param f ignored
     */
    @Override
    public void setFilled(boolean f) {
        // ignored - fixed rendering
    }

    @Override
    public boolean isFilled() {
        return true;
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        head.setLineWidth(w);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineWidth()
     */
    @Override
    public int getLineWidth() {
        return head.getLineWidth();
    }

    ////////////////////////////////////////////////////////////////
    // Event handlers

    /*
     * @see java.awt.event.MouseListener#mouseClicked(java.awt.event.MouseEvent)
     */
    @Override
]]>
</codefragment>
</duplication>
<duplication lines="43" tokens="121">
<file line="442" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/ui/UMLDeploymentDiagram.java"/>
<file line="381" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/use_case/ui/UMLUseCaseDiagram.java"/>
<codefragment>
<![CDATA[
    }

    /**
     * @return Returns the actionUniAggregation.
     */
    protected Action getActionUniAggregation() {
        if (actionUniAggregation == null) {
            actionUniAggregation =
                new RadioAction(
                    new ActionSetAddAssociationMode(
                        Model.getAggregationKind().getAggregate(),
                        true, "button.new-uniaggregation"));
        }
        return actionUniAggregation;
    }

    /**
     * @return Returns the actionUniAssociation.
     */
    protected Action getActionUniAssociation() {
        if (actionUniAssociation == null) {
            actionUniAssociation =
                new RadioAction(
                    new ActionSetAddAssociationMode(
                        Model.getAggregationKind().getNone(),
                        true, "button.new-uniassociation"));
        }
        return actionUniAssociation;
    }

    /**
     * @return Returns the actionUniComposition.
     */
    protected Action getActionUniComposition() {
        if (actionUniComposition == null) {
            actionUniComposition =
                new RadioAction(
                    new ActionSetAddAssociationMode(
                        Model.getAggregationKind().getComposite(),
                        true, "button.new-unicomposition"));
        }
        return actionUniComposition;
    }
]]>
</codefragment>
</duplication>
<duplication lines="29" tokens="119">
<file line="88" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionAddClientDependencyAction.java"/>
<file line="88" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionAddSupplierDependencyAction.java"/>
<codefragment>
<![CDATA[
            if (oldSet.containsAll(Model.getFacade().getSuppliers(dependency))) {
                toBeDeleted.add(dependency);
            }
        }
        ProjectManager.getManager().getCurrentProject()
            .moveToTrash(toBeDeleted);
    }

    /*
     * @see org.argouml.uml.ui.AbstractActionAddModelElement#getChoices()
     */
    protected List getChoices() {
        List ret = new ArrayList();
        Object model =
            ProjectManager.getManager().getCurrentProject().getModel();
        if (getTarget() != null) {
            Object modelElementType = Model.getMetaTypes().getModelElement();
            ret.addAll(Model.getModelManagementHelper()
                    .getAllModelElementsOfKind(model, modelElementType));
            ret.remove(getTarget());
        }
        return ret;
    }

    /*
     * @see org.argouml.uml.ui.AbstractActionAddModelElement#getDialogTitle()
     */
    protected String getDialogTitle() {
        return Translator.localize("dialog.title.add-client-dependency");
]]>
</codefragment>
</duplication>
<duplication lines="28" tokens="118">
<file line="69" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/cmd/ActionNew.java"/>
<file line="69" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/cmd/ActionNewProfile.java"/>
<codefragment>
<![CDATA[
                Translator.localize("action.new"));
    }

    ////////////////////////////////////////////////////////////////
    // main methods

    /*
     * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
     */
    public void actionPerformed(ActionEvent e) {
        Model.getPump().flushModelEvents();
        Model.getPump().stopPumpingEvents();
        Model.getPump().flushModelEvents();
        Project p = ProjectManager.getManager().getCurrentProject();

        if (getValue("non-interactive") == null) {
            if (!ProjectBrowser.getInstance().askConfirmationAndSave()) {
                return;
            }
        }

        ProjectBrowser.getInstance().clearDialogs();
        Designer.disableCritiquing();
        Designer.clearCritiquing();
        // clean the history
        TargetManager.getInstance().cleanHistory();
        p.remove();
        p = ProjectManager.getManager().makeEmptyProject();
]]>
</codefragment>
</duplication>
<duplication lines="15" tokens="117">
<file line="76" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/cmd/RelationshipActionFactory.java"/>
<file line="138" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/cmd/RelationshipActionFactory.java"/>
<codefragment>
<![CDATA[
        ActionList al= new ActionList("Add Associations from ");
        if (Model.getFacade().isAClass(element)) {
            Collection associationEnds = Model.getFacade().getAssociationEnds(element);
            
            for (Object associationEnd : associationEnds) {
                Object association = Model.getFacade().getAssociation(associationEnd);
                
                // Only show actions for associations not already on diagram
                if (diagram.presentationFor(association) == null) {
                    Collection connections = Model.getFacade().getConnections(association);
                    if (connections.size() == 2) {
                        for (Object connection : connections) {
                            if (connection != associationEnd) {
                                final String direction;
                                if (Model.getFacade().isNavigable(associationEnd)) {
]]>
</codefragment>
</duplication>
<duplication lines="33" tokens="117">
<file line="108" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleDeepHistoryStates.java"/>
<file line="106" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleInitialStates.java"/>
<file line="108" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleShallowHistoryStates.java"/>
<codefragment>
<![CDATA[
                            Model.getPseudostateKind().getDeepHistory())) {
                initialStateCount++;
            }
        }
        if (initialStateCount > 1) {
            return PROBLEM_FOUND;
        }
        return NO_PROBLEM;
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#toDoItem(java.lang.Object,
     *      org.argouml.cognitive.Designer)
     */
    @Override
    public ToDoItem toDoItem(Object dm, Designer dsgr) {
        ListSet offs = computeOffenders(dm);
        return new UMLToDoItem(this, offs, dsgr);
    }

    /**
     * @param ps the design material
     * @return the offenders
     */
    protected ListSet computeOffenders(Object ps) {
        ListSet offs = new ListSet(ps);
        Object cs = Model.getFacade().getContainer(ps);
        if (cs == null) {
            LOG.log(Level.FINE, "null parent in still valid");
            return offs;
        }
        Collection peers = Model.getFacade().getSubvertices(cs);
        for (Iterator iter = peers.iterator(); iter.hasNext();) {
]]>
</codefragment>
</duplication>
<duplication lines="14" tokens="117">
<file line="367" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigConcurrentRegion.java"/>
<file line="398" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigConcurrentRegion.java"/>
<codefragment>
<![CDATA[
        int h = oldBounds.height + hInc;

        dividerline.setShape(x, y,
                x + w , y);
        getNameFig().setBounds(x + 2, y + 2, w - 4, nameDim.height);
        getInternal().setBounds(x + 2, y + nameDim.height + 4,
                w - 4, h - nameDim.height - 8);
        getBigPort().setBounds(x, y, w, h);
        cover.setBounds(x, y, w, h);

        calcBounds(); //_x = x; _y = y; _w = w; _h = h;
        updateEdges();
        firePropChange("bounds", oldBounds, getBounds());
    }
]]>
</codefragment>
</duplication>
<duplication lines="19" tokens="115">
<file line="454" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/profile/internal/ocl/EvaluateExpression.java"/>
<file line="789" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/profile/internal/ocl/EvaluateExpression.java"/>
<codefragment>
<![CDATA[
        inAFeaturePrimaryExpression(node);
        if (node.getPathName() != null) {
            // TODO support other name kinds
            node.getPathName().apply(this);
            feature = node.getPathName().toString().trim();
        }
        if (node.getTimeExpression() != null) {
            // hypotheses no time expression (only invariants)
            node.getTimeExpression().apply(this);
        }
        if (node.getQualifiers() != null) {
            // XXX: hypotheses no qualifiers (I don't know)
            node.getQualifiers().apply(this);
        }
        if (node.getFeatureCallParameters() != null) {
            val = null;
            node.getFeatureCallParameters().apply(this);
            parameters = (List) val;
        }
]]>
</codefragment>
</duplication>
<duplication lines="21" tokens="115">
<file line="87" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigCompositeState.java"/>
<file line="75" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigSimpleState.java"/>
<codefragment>
<![CDATA[
    private void initFigs() {
        cover =
            new FigRRect(getInitialX(), getInitialY(),
			      getInitialWidth(), getInitialHeight(),
			      LINE_COLOR, FILL_COLOR);

        getBigPort().setLineWidth(0);

        divider =
	    new FigLine(getInitialX(),
			getInitialY() + 2 + getNameFig().getBounds().height + 1,
			getInitialWidth() - 1,
			getInitialY() + 2 + getNameFig().getBounds().height + 1,
			LINE_COLOR);

        // add Figs to the FigNode in back-to-front order
        addFig(getBigPort());
        addFig(cover);
        addFig(getNameFig());
        addFig(divider);
        addFig(getInternal());
]]>
</codefragment>
</duplication>
<duplication lines="49" tokens="115">
<file line="171" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigSimpleState.java"/>
<file line="268" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigSubmachineState.java"/>
<codefragment>
<![CDATA[
        divider.setLineColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getLineColor()
     */
    @Override
    public Color getLineColor() {
        return cover.getLineColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFillColor(java.awt.Color)
     */
    @Override
    public void setFillColor(Color col) {
        cover.setFillColor(col);
    }

    /*
     * @see org.tigris.gef.presentation.Fig#getFillColor()
     */
    @Override
    public Color getFillColor() {
        return cover.getFillColor();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setFilled(boolean)
     */
    @Override
    public void setFilled(boolean f) {
        cover.setFilled(f);
        getBigPort().setFilled(f);
    }


    @Override
    public boolean isFilled() {
        return cover.isFilled();
    }

    /*
     * @see org.tigris.gef.presentation.Fig#setLineWidth(int)
     */
    @Override
    public void setLineWidth(int w) {
        cover.setLineWidth(w);
        divider.setLineWidth(w);
]]>
</codefragment>
</duplication>
<duplication lines="20" tokens="114">
<file line="105" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepChoice.java"/>
<file line="89" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepConfirm.java"/>
<codefragment>
<![CDATA[
	gb.setConstraints(image, c);
	getMainPanel().add(image);

	c.weightx = 1.0;
	c.gridx = 2;
	c.gridheight = 1;
	c.gridwidth = 3;
	c.gridy = 0;
	c.fill = GridBagConstraints.HORIZONTAL;
	gb.setConstraints(instructions, c);
	getMainPanel().add(instructions);

	c.gridx = 1;
	c.gridy = 1;
	c.weightx = 0.0;
	c.gridwidth = 1;
	c.fill = GridBagConstraints.NONE;
	SpacerPanel spacer = new SpacerPanel();
	gb.setConstraints(spacer, c);
	getMainPanel().add(spacer);
]]>
</codefragment>
</duplication>
<duplication lines="23" tokens="114">
<file line="336" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigConcurrentRegion.java"/>
<file line="369" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigConcurrentRegion.java"/>
<codefragment>
<![CDATA[
        dividerline.setShape(x, y, x + w , y);
        getNameFig().setBounds(x + 2, y + 2, w - 4, nameDim.height);
        getInternal().setBounds(x + 2, y + nameDim.height + 4,
                w - 4, h - nameDim.height - 8);
        getBigPort().setBounds(x, y, w, h);
        cover.setBounds(x, y, w, h);

        calcBounds(); //_x = x; _y = y; _w = w; _h = h;
        updateEdges();
        firePropChange("bounds", oldBounds, getBounds());
    }

    /**
     * To resize with X, Y and height increments and absolute width.
     * The boolean parameter is added in order to override the method.
     *
     * @param xInc the x increment
     * @param yInc the y increment
     * @param w the width
     * @param concurrency is concurrent?
     * @param hInc the height increment
     */
    public void setBounds(int xInc, int yInc, int w, int hInc,
]]>
</codefragment>
</duplication>
<duplication lines="19" tokens="114">
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionSetGeneralizableElementAbstract.java"/>
<file line="66" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionSetGeneralizableElementLeaf.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionSetGeneralizableElementRoot.java"/>
<codefragment>
<![CDATA[
    protected ActionSetGeneralizableElementAbstract() {
        super(Translator.localize("Set"), null);
        // Set the tooltip string:
        putValue(Action.SHORT_DESCRIPTION, 
                Translator.localize("Set"));
    }

    /*
     * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
     */
    public void actionPerformed(ActionEvent e) {
        super.actionPerformed(e);
        if (e.getSource() instanceof UMLCheckBox2) {
            UMLCheckBox2 source = (UMLCheckBox2) e.getSource();
            Object target = source.getTarget();
            if (Model.getFacade().isAGeneralizableElement(target)
                    || Model.getFacade().isAOperation(target)
                    || Model.getFacade().isAReception(target)) {
                Model.getCoreHelper().setAbstract(target, source.isSelected());
]]>
</codefragment>
</duplication>
<duplication lines="41" tokens="113">
<file line="102" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/persistence/OldZargoFilePersister.java"/>
<file line="140" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/persistence/UmlFilePersister.java"/>
<file line="109" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/persistence/XmiFilePersister.java"/>
<codefragment>
<![CDATA[
    }

    /**
     * Save the project in ".zargo" format.
     *
     * @param file
     *            The file to write.
     * @param project
     *            the project to save
     * @throws SaveException
     *             when anything goes wrong
     * @throws InterruptedException     if the thread is interrupted
     *
     * @see org.argouml.persistence.ProjectFilePersister#save(
     *      org.argouml.kernel.Project, java.io.File)
     */
    public void doSave(Project project, File file) throws SaveException,
    InterruptedException {

        /* Retain the previous project file even when the save operation
         * crashes in the middle. Also create a backup file after saving. */
        boolean doSafeSaves = useSafeSaves();

        ProgressMgr progressMgr = new ProgressMgr();
        progressMgr.setNumberOfPhases(4);
        progressMgr.nextPhase();

        File lastArchiveFile = new File(file.getAbsolutePath() + "~");
        File tempFile = null;

        if (doSafeSaves) {
            try {
                tempFile = createTempFile(file);
            } catch (FileNotFoundException e) {
                throw new SaveException(Translator.localize(
                        "optionpane.save-project-exception-cause1"), e);
            } catch (IOException e) {
                throw new SaveException(Translator.localize(
                        "optionpane.save-project-exception-cause2"), e);
            }
        }
]]>
</codefragment>
</duplication>
<duplication lines="26" tokens="112">
<file line="87" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/ui/SelectionComponent.java"/>
<file line="82" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/ui/SelectionComponentInstance.java"/>
<codefragment>
<![CDATA[
    public SelectionComponent(Fig f) {
        super(f);
    }

    @Override
    protected Icon[] getIcons() {
        if (Model.getModelManagementHelper().isReadOnly(
                getContent().getOwner())) {
            return new Icon[] {null, dep, depRight, null, null };
        }
        return icons;
    }

    @Override
    protected String getInstructions(int index) {
        return instructions[index - BASE];
    }

    @Override
    protected Object getNewEdgeType(int index) {
        return Model.getMetaTypes().getDependency();
    }

    @Override
    protected Object getNewNode(int index) {
        return Model.getCoreFactory().createComponent();
]]>
</codefragment>
</duplication>
<duplication lines="17" tokens="112">
<file line="115" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/ui/SettingsTabNotation.java"/>
<file line="120" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/SettingsTabDiagramAppearance.java"/>
<codefragment>
<![CDATA[
        topPanel.setLayout(new BorderLayout());

        if (scope == Argo.SCOPE_APPLICATION) {
            JPanel warning = new JPanel();
            warning.setLayout(new BoxLayout(warning, BoxLayout.PAGE_AXIS));
            JLabel warningLabel = new JLabel(Translator
                    .localize("label.warning"));
            warningLabel.setAlignmentX(Component.RIGHT_ALIGNMENT);
            warning.add(warningLabel);

            JLinkButton projectSettings = new JLinkButton();
            projectSettings.setAction(new ActionProjectSettings());
            projectSettings.setText(Translator
                    .localize("button.project-settings"));
            projectSettings.setIcon(null);
            projectSettings.setAlignmentX(Component.RIGHT_ALIGNMENT);
            warning.add(projectSettings);
]]>
</codefragment>
</duplication>
<duplication lines="18" tokens="111">
<file line="332" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/UmlDiagramRenderer.java"/>
<file line="962" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/UMLClassDiagram.java"/>
<codefragment>
<![CDATA[
    protected FigNode getNodePresentationFor(Layer lay, Object modelElement) {
        assert modelElement != null : "A modelElement must be supplied";
        for (Object fig : lay.getContentsNoEdges()) {
 
            if (fig instanceof FigNode
                    && modelElement.equals(((FigNode) fig).getOwner())) {
                return ((FigNode) fig);
            }
        }
        for (Object fig : lay.getContentsEdgesOnly()) {
            if (fig instanceof FigEdgeModelElement
                    && modelElement.equals(((FigEdgeModelElement) fig)
                            .getOwner())) {
                return ((FigEdgeModelElement) fig).getEdgePort();
            }
        }
        return null;
    }
]]>
</codefragment>
</duplication>
<duplication lines="16" tokens="111">
<file line="418" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigEdgeModelElement.java"/>
<file line="682" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigNodeModelElement.java"/>
<codefragment>
<![CDATA[
        Collection<Object> elements = new ArrayList<Object>();
        Object owner = getOwner();
        if (owner != null) {
            elements.add(owner);
        }
        for (Object o : TargetManager.getInstance().getTargets()) {
            Object element = null;
            if (Model.getFacade().isAUMLElement(o)) {
                element = o;
            } else if (o instanceof Fig) {
                element = ((Fig) o).getOwner();
            }
            if (element != null && element != owner) {
                elements.add(element);
            }
        }
]]>
</codefragment>
</duplication>
<duplication lines="20" tokens="110">
<file line="83" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepChoice.java"/>
<file line="72" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepCue.java"/>
<file line="80" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepManyTextFields.java"/>
<file line="71" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/cognitive/ui/WizStepTextField.java"/>
<codefragment>
<![CDATA[
	instructions.setEditable(false);
	instructions.setBorder(null);
	instructions.setBackground(getMainPanel().getBackground());

	getMainPanel().setBorder(new EtchedBorder());

	GridBagLayout gb = new GridBagLayout();
	getMainPanel().setLayout(gb);

	GridBagConstraints c = new GridBagConstraints();
	c.ipadx = 3; c.ipady = 3;
	c.weightx = 0.0; c.weighty = 0.0;
	c.anchor = GridBagConstraints.EAST;

	JLabel image = new JLabel("");
	//image.setMargin(new Insets(0, 0, 0, 0));
	image.setIcon(getWizardIcon());
	image.setBorder(null);
	c.gridx = 0;
	c.gridheight = GridBagConstraints.REMAINDER;
]]>
</codefragment>
</duplication>
<duplication lines="15" tokens="110">
<file line="1111" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/NotationUtilityUml.java"/>
<file line="734" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/TransitionNotationUml.java"/>
<codefragment>
<![CDATA[
    private static String generateKind(Object /*Parameter etc.*/ kind) {
        StringBuffer s = new StringBuffer();
        // TODO: I18N
        if (kind == null /* "in" is the default */
                || kind == Model.getDirectionKind().getInParameter()) {
            s.append(/*"in"*/ ""); /* See issue 3421. */
        } else if (kind == Model.getDirectionKind().getInOutParameter()) {
            s.append("inout");
        } else if (kind == Model.getDirectionKind().getReturnParameter()) {
            // return nothing
        } else if (kind == Model.getDirectionKind().getOutParameter()) {
            s.append("out");
        }
        return s.toString();
    }
]]>
</codefragment>
</duplication>
<duplication lines="64" tokens="110">
<file line="76" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/JasonsBigTheme.java"/>
<file line="76" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/JasonsHugeTheme.java"/>
<file line="76" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/JasonsTheme.java"/>
<codefragment>
<![CDATA[
    public String getName() { return "Large Fonts"; }

    // these are blue in Metal Default Theme
    /*
     * @see javax.swing.plaf.metal.MetalTheme#getPrimary1()
     */
    protected ColorUIResource getPrimary1() { return primary1; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getPrimary2()
     */
    protected ColorUIResource getPrimary2() { return primary2; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getPrimary3()
     */
    protected ColorUIResource getPrimary3() { return primary3; }

    // these are gray in Metal Default Theme
    /*
     * @see javax.swing.plaf.metal.MetalTheme#getSecondary1()
     */
    protected ColorUIResource getSecondary1() { return secondary1; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getSecondary2()
     */
    protected ColorUIResource getSecondary2() { return secondary2; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getSecondary3()
     */
    protected ColorUIResource getSecondary3() { return secondary3; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getControlTextFont()
     */
    public FontUIResource getControlTextFont() { return controlFont; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getSystemTextFont()
     */
    public FontUIResource getSystemTextFont() { return systemFont; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getUserTextFont()
     */
    public FontUIResource getUserTextFont() { return userFont; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getMenuTextFont()
     */
    public FontUIResource getMenuTextFont() { return controlFont; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getSubTextFont()
     */
    public FontUIResource getSubTextFont() { return smallFont; }

    /*
     * @see javax.swing.plaf.metal.MetalTheme#getWindowTitleFont()
     */
    public FontUIResource getWindowTitleFont() { return windowTitleFont; }
}
]]>
</codefragment>
</duplication>
<duplication lines="26" tokens="110">
<file line="120" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ui/StylePanelFigClass.java"/>
<file line="196" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/StylePanelFigAssociationClass.java"/>
<codefragment>
<![CDATA[
    }

    ////////////////////////////////////////////////////////////////
    // event handling

    /*
     * @see java.awt.event.ItemListener#itemStateChanged(java.awt.event.ItemEvent)
     */
    public void itemStateChanged(ItemEvent e) {
        if (!refreshTransaction) {
            Object src = e.getSource();

            if (src == attrCheckBox) {
                FigCompartmentBox fcb = (FigCompartmentBox) getPanelTarget();
                fcb.showCompartment(Model.getMetaTypes().getAttribute(), 
                        attrCheckBox.isSelected());
            } else if (src == operCheckBox) {
                FigCompartmentBox fcb = (FigCompartmentBox) getPanelTarget();
                fcb.showCompartment(Model.getMetaTypes().getOperation(),
                        operCheckBox.isSelected());
            } else {
                super.itemStateChanged(e);
            }
        }
    }
} /* end class StylePanelFigClass */
]]>
</codefragment>
</duplication>
<duplication lines="27" tokens="110">
<file line="80" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/ActionAddMessage.java"/>
<file line="78" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionAddOperation.java"/>
<codefragment>
<![CDATA[
            targetFollower  = new ActionAddMessage();
            TargetManager.getInstance().addTargetListener(new TargetListener() {
                public void targetAdded(TargetEvent e) {
                    setTarget();
                }
                public void targetRemoved(TargetEvent e) {
                    setTarget();
                }

                public void targetSet(TargetEvent e) {
                    setTarget();
                }
                private void setTarget() {
                    targetFollower.setEnabled(targetFollower.shouldBeEnabled());
                }
            });
            targetFollower.setEnabled(targetFollower.shouldBeEnabled());
        }
        return targetFollower;
    }

    /*
     * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
     */
    public void actionPerformed(ActionEvent ae) {
        super.actionPerformed(ae);
    	Object target =  TargetManager.getInstance().getModelTarget();
]]>
</codefragment>
</duplication>
<duplication lines="21" tokens="109">
<file line="200" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/EnumerationLiteralNotationUml.java"/>
<file line="301" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/providers/uml/NotationUtilityUml.java"/>
<codefragment>
<![CDATA[
            st = new MyTokenizer(text, "<<,\u00AB,\u00BB,>>");
            while (st.hasMoreTokens()) {
                token = st.nextToken();

                if ("<<".equals(token) || "\u00AB".equals(token)) {
                    if (stereotype != null) {
                        String msg = 
                            "parsing.error.model-element-name.twin-stereotypes";
                        throw new ParseException(Translator.localize(msg),
                                st.getTokenIndex());
                    }

                    stereotype = new StringBuilder();
                    while (true) {
                        token = st.nextToken();
                        if (">>".equals(token) || "\u00BB".equals(token)) {
                            break;
                        }
                        stereotype.append(token);
                    }
                } else {
]]>
</codefragment>
</duplication>
<duplication lines="11" tokens="109">
<file line="336" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigConcurrentRegion.java"/>
<file line="400" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/state/ui/FigConcurrentRegion.java"/>
<codefragment>
<![CDATA[
        dividerline.setShape(x, y, x + w , y);
        getNameFig().setBounds(x + 2, y + 2, w - 4, nameDim.height);
        getInternal().setBounds(x + 2, y + nameDim.height + 4,
                w - 4, h - nameDim.height - 8);
        getBigPort().setBounds(x, y, w, h);
        cover.setBounds(x, y, w, h);

        calcBounds(); //_x = x; _y = y; _w = w; _h = h;
        updateEdges();
        firePropChange("bounds", oldBounds, getBounds());
    }
]]>
</codefragment>
</duplication>
<duplication lines="21" tokens="107">
<file line="124" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigAssociationClass.java"/>
<file line="336" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/FigNodeAssociation.java"/>
<codefragment>
<![CDATA[
        if (edges != null) {
            for (Iterator it = edges.iterator(); it.hasNext()
                    && figEdgeLink == null;) {
                Object o = it.next();
                if (o instanceof FigEdgeAssociationClass) {
                    figEdgeLink = (FigEdgeAssociationClass) o;
                }
            }
        }

        if (figEdgeLink != null) {
            FigNode figClassBox = figEdgeLink.getDestFigNode();
            if (!(figClassBox instanceof FigClassAssociationClass)) {
                figClassBox = figEdgeLink.getSourceFigNode();
            }
            figEdgeLink.removeFromDiagramImpl();
            ((FigClassAssociationClass) figClassBox).removeFromDiagramImpl();
        }

        super.removeFromDiagramImpl();
    }
]]>
</codefragment>
</duplication>
<duplication lines="36" tokens="107">
<file line="352" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/static_structure/ClassDiagramGraphModel.java"/>
<file line="282" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/use_case/UseCaseDiagramGraphModel.java"/>
<codefragment>
<![CDATA[
        } else {
            return false;
        }

        if (sourceModelElement == null || destModelElement == null) {
            LOG.log(Level.SEVERE,
                    "Edge rejected. Its ends are not attached to anything");
            return false;
        }

        if (!containsNode(sourceModelElement)
                && !containsEdge(sourceModelElement)) {
            LOG.log(Level.SEVERE,
                    "Edge rejected. Its source end is attached to "
                    + sourceModelElement
                    + " but this is not in the graph model");
            return false;
        }
        if (!containsNode(destModelElement)
                && !containsEdge(destModelElement)) {
            LOG.log(Level.SEVERE,
                    "Edge rejected. Its destination end is attached to "
                    + destModelElement
                    + " but this is not in the graph model");
            return false;
        }

        return true;
    }


    /*
     * @see org.tigris.gef.graph.MutableGraphModel#addNode(java.lang.Object)
     */
    @Override
    public void addNode(Object node) {
]]>
</codefragment>
</duplication>
<duplication lines="27" tokens="107">
<file line="80" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/ui/ActionAddMessage.java"/>
<file line="81" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionAddAttribute.java"/>
<file line="78" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/foundation/core/ActionAddOperation.java"/>
<codefragment>
<![CDATA[
            targetFollower  = new ActionAddMessage();
            TargetManager.getInstance().addTargetListener(new TargetListener() {
                public void targetAdded(TargetEvent e) {
                    setTarget();
                }
                public void targetRemoved(TargetEvent e) {
                    setTarget();
                }

                public void targetSet(TargetEvent e) {
                    setTarget();
                }
                private void setTarget() {
                    targetFollower.setEnabled(targetFollower.shouldBeEnabled());
                }
            });
            targetFollower.setEnabled(targetFollower.shouldBeEnabled());
        }
        return targetFollower;
    }

    /*
     * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
     */
    public void actionPerformed(ActionEvent ae) {
        super.actionPerformed(ae);
    	Object target =  TargetManager.getInstance().getModelTarget();
]]>
</codefragment>
</duplication>
<duplication lines="24" tokens="106">
<file line="80" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/ui/SelectionNodeInstance.java"/>
<file line="81" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/diagram/deployment/ui/SelectionObject.java"/>
<codefragment>
<![CDATA[
    public SelectionNodeInstance(Fig f) { super(f); }

    @Override
    protected Icon[] getIcons() {
        if (Model.getModelManagementHelper().isReadOnly(
                getContent().getOwner())) {
            return new Icon[6];
        }
        return icons;
    }

    @Override
    protected String getInstructions(int index) {
        return instructions[index - BASE];
    }

    @Override
    protected Object getNewEdgeType(int index) {
        return Model.getMetaTypes().getLink();
    }

    @Override
    protected Object getNewNode(int index) {
        return Model.getCommonBehaviorFactory().createNodeInstance();
]]>
</codefragment>
</duplication>
<duplication lines="16" tokens="105">
<file line="118" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/notation/ui/SettingsTabNotation.java"/>
<file line="96" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/SettingsTabUser.java"/>
<codefragment>
<![CDATA[
            JPanel warning = new JPanel();
            warning.setLayout(new BoxLayout(warning, BoxLayout.PAGE_AXIS));
            JLabel warningLabel = new JLabel(Translator
                    .localize("label.warning"));
            warningLabel.setAlignmentX(Component.RIGHT_ALIGNMENT);
            warning.add(warningLabel);

            JLinkButton projectSettings = new JLinkButton();
            projectSettings.setAction(new ActionProjectSettings());
            projectSettings.setText(Translator
                    .localize("button.project-settings"));
            projectSettings.setIcon(null);
            projectSettings.setAlignmentX(Component.RIGHT_ALIGNMENT);
            warning.add(projectSettings);

            topPanel.add(warning, BorderLayout.NORTH);
]]>
</codefragment>
</duplication>
<duplication lines="15" tokens="105">
<file line="76" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/cmd/RelationshipActionFactory.java"/>
<file line="107" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/cmd/RelationshipActionFactory.java"/>
<file line="138" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/cmd/RelationshipActionFactory.java"/>
<codefragment>
<![CDATA[
        ActionList al= new ActionList("Add Associations from ");
        if (Model.getFacade().isAClass(element)) {
            Collection associationEnds = Model.getFacade().getAssociationEnds(element);
            
            for (Object associationEnd : associationEnds) {
                Object association = Model.getFacade().getAssociation(associationEnd);
                
                // Only show actions for associations not already on diagram
                if (diagram.presentationFor(association) == null) {
                    Collection connections = Model.getFacade().getConnections(association);
                    if (connections.size() == 2) {
                        for (Object connection : connections) {
                            if (connection != associationEnd) {
                                final String direction;
                                if (Model.getFacade().isNavigable(associationEnd)) {
]]>
</codefragment>
</duplication>
<duplication lines="39" tokens="105">
<file line="122" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNoIncomingTransitions.java"/>
<file line="121" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNoOutgoingTransitions.java"/>
<codefragment>
<![CDATA[
            if (!isSomeSubvertexOf(sourceState, dm) && isSomeSubvertexOf(targetState, dm)) {
                return NO_PROBLEM;
            }
        }

        return PROBLEM_FOUND;
    }
    
    /**
     * Test if a state is contained within a composite state recursively. 
     * This is done by checking if the parent of the subject 
     * equals the composite, or the parent of the parent, etc.
     * 
     * @param subject the StateVertex that is investigated
     * @param composite the Composite state that may or may not contain the subject
     * @return true if and only if the given composite contains recursively the given subject
     */
    private boolean isSomeSubvertexOf(Object subject, Object composite) {
        Object c = subject;
        while (c != null) {
            if (c == composite) {
                return true;
            }
            c = Model.getFacade().getContainer(c);
        }
        return false;
    }

    /*
     * @see org.argouml.uml.cognitive.critics.CrUML#getCriticizedDesignMaterials()
     */
    @Override
    public Set<Object> getCriticizedDesignMaterials() {
        Set<Object> ret = new HashSet<Object>();
        ret.add(Model.getMetaTypes().getStateVertex());
        return ret;
    }
    
}
]]>
</codefragment>
</duplication>
<duplication lines="19" tokens="104">
<file line="88" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleInitialStates.java"/>
<file line="91" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMultipleShallowHistoryStates.java"/>
<codefragment>
<![CDATA[
                Model.getPseudostateKind().getInitial())) {
	    return NO_PROBLEM;
        }

        // container state / composite state
        Object cs = Model.getFacade().getContainer(dm);
        if (cs == null) {
            LOG.log(Level.FINE, "null parent state");
            return NO_PROBLEM;
        }

        int initialStateCount = 0;
        Collection peers = Model.getFacade().getSubvertices(cs);
        for (Object sv : peers) {
            if (Model.getFacade().isAPseudostate(sv)
                && Model.getFacade().
                	equalsPseudostateKind(
                	        Model.getFacade().getKind(sv),
                	        Model.getPseudostateKind().getInitial())) {
]]>
</codefragment>
</duplication>
<duplication lines="28" tokens="104">
<file line="82" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNoInstanceVariables.java"/>
<file line="77" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNoOperations.java"/>
<codefragment>
<![CDATA[
	if (!(Model.getFacade().isAClass(dm))) {
            return NO_PROBLEM;
        }

	if (!(Model.getFacade().isPrimaryObject(dm))) {
            return NO_PROBLEM;
        }

        // if the object does not have a name,
        // than no problem
        if ((Model.getFacade().getName(dm) == null)
                || ("".equals(Model.getFacade().getName(dm)))) {
            return NO_PROBLEM;
        }

	// types can probably have variables, but we should not nag at them
	// not having any.
	if (Model.getFacade().isType(dm)) {
            return NO_PROBLEM;
        }

	// utility is a namespace collection - also not strictly
	// required to have variables.
	if (Model.getFacade().isUtility(dm)) {
            return NO_PROBLEM;
        }

	if (findChangeableInstanceAttributeInInherited(dm, 0)) {
]]>
</codefragment>
</duplication>
<duplication lines="26" tokens="104">
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNoIncomingTransitions.java"/>
<file line="65" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNoOutgoingTransitions.java"/>
<codefragment>
<![CDATA[
	addTrigger("incoming");
    }

    /**
     * This is the decision routine for the critic.
     *
     * @param dm is the design material, i.e. the 
     *     UML entity that is being checked.
     * @param dsgr is for future development and can be ignored.
     *
     * @return boolean problem found
     */
    @Override
    public boolean predicate2(Object dm, Designer dsgr) {
        if (!(Model.getFacade().isAStateVertex(dm))) {
            return NO_PROBLEM;
        }
        /* Now we are sure dm is a StateVertex. */
        if (Model.getFacade().isAPseudostate(dm)) {
            Object k = Model.getFacade().getKind(dm);
            if (k.equals(Model.getPseudostateKind().getChoice())) {
                return NO_PROBLEM;
            }
            if (k.equals(Model.getPseudostateKind().getJunction())) {
                return NO_PROBLEM;
            }
]]>
</codefragment>
</duplication>
<duplication lines="14" tokens="102">
<file line="126" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/SettingsTabProfile.java"/>
<file line="94" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/SettingsTabUser.java"/>
<codefragment>
<![CDATA[
        setLayout(new BorderLayout());

        JPanel warning = new JPanel();
        warning.setLayout(new BoxLayout(warning, BoxLayout.PAGE_AXIS));
        JLabel warningLabel = new JLabel(Translator.localize("label.warning"));
        warningLabel.setAlignmentX(Component.RIGHT_ALIGNMENT);
        warning.add(warningLabel);

        JLinkButton projectSettings = new JLinkButton();
        projectSettings.setAction(new ActionProjectSettings());
        projectSettings.setText(Translator.localize("button.project-settings"));
        projectSettings.setIcon(null);
        projectSettings.setAlignmentX(Component.RIGHT_ALIGNMENT);
        warning.add(projectSettings);
]]>
</codefragment>
</duplication>
<duplication lines="17" tokens="101">
<file line="163" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/profile/internal/ocl/uml14/CollectionsModelInterpreter.java"/>
<file line="240" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/profile/internal/ocl/uml14/CollectionsModelInterpreter.java"/>
<codefragment>
<![CDATA[
                } else if (feature.toString().trim().equals("exists")) {
                    List<String> vars = (ArrayList<String>) parameters[0];
                    Object exp = parameters[1];
                    LambdaEvaluator eval = (LambdaEvaluator) parameters[2];

                    Collection col = (Collection) subject;

                    // TODO is it possible to use more than one variable?
                    String varName = vars.get(0);
                    Object oldVal = vt.get(varName);

                    for (Object object : col) {
                        vt.put(varName, object);

                        Object val = eval.evaluate(vt, exp);
                        if (val instanceof Boolean && (Boolean) val) {
                            return true;
]]>
</codefragment>
</duplication>
<duplication lines="15" tokens="101">
<file line="49" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/JasonsHugeTheme.java"/>
<file line="49" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/ui/JasonsTheme.java"/>
<codefragment>
<![CDATA[
public class JasonsHugeTheme extends MetalTheme {

    private final ColorUIResource primary1 = new ColorUIResource(102, 102, 153);
    private final ColorUIResource primary2 = new ColorUIResource(153, 153, 204);
    private final ColorUIResource primary3 = new ColorUIResource(204, 204, 255);

    private final ColorUIResource secondary1 =
	new ColorUIResource(102, 102, 102);
    private final ColorUIResource secondary2 =
	new ColorUIResource(153, 153, 153);
    private final ColorUIResource secondary3 =
	new ColorUIResource(204, 204, 204);

    private final FontUIResource controlFont =
	new FontUIResource("SansSerif", Font.BOLD, 16);
]]>
</codefragment>
</duplication>
<duplication lines="26" tokens="101">
<file line="78" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMissingClassName.java"/>
<file line="97" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrMissingStateName.java"/>
<codefragment>
<![CDATA[
	String myName = Model.getFacade().getName(e);
	if (myName == null || myName.equals("") || myName.length() == 0) {
	    return PROBLEM_FOUND;
	}
	return NO_PROBLEM;
    }

    /*
     * @see org.argouml.cognitive.Poster#getClarifier()
     */
    @Override
    public Icon getClarifier() {
	return ClClassName.getTheInstance();
    }

    /*
     * @see org.argouml.cognitive.critics.Critic#initWizard(
     *         org.argouml.cognitive.ui.Wizard)
     */
    @Override
    public void initWizard(Wizard w) {
	if (w instanceof WizMEName) {
	    ToDoItem item = (ToDoItem) w.getToDoItem();
	    Object me = item.getOffenders().get(0);
	    String ins = super.getInstructions();
	    String sug = super.getDefaultSuggestion();
]]>
</codefragment>
</duplication>
<duplication lines="29" tokens="101">
<file line="122" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrAssocNameConflict.java"/>
<file line="127" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/cognitive/critics/CrNameConflict.java"/>
<codefragment>
<![CDATA[
                }
                names.put(name, name1Object);
            }
        }
        return offenderResult;
    }

    /*
     * @see org.argouml.cognitive.Poster#stillValid(
     *      org.argouml.cognitive.ToDoItem, org.argouml.cognitive.Designer)
     */
    @Override
    public boolean stillValid(ToDoItem i, Designer dsgr) {
        if (!isActive()) {
            return false;
        }
        ListSet offs = i.getOffenders();

        // first element is e.g. the class, but we need to have its namespace
        // to recompute the offenders.
        Object f = offs.get(0);
        Object ns = Model.getFacade().getNamespace(f);
        if (!predicate(ns, dsgr)) {
            return false;
        }
        ListSet newOffs = computeOffenders(ns);
        boolean res = offs.equals(newOffs);
        return res;
    }
]]>
</codefragment>
</duplication>
<duplication lines="24" tokens="100">
<file line="701" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/TabConstraints.java"/>
<file line="729" path="/home/linus/project/argouml/github@-repo/argouml/src/argouml-app/src/org/argouml/uml/ui/TabConstraints.java"/>
<codefragment>
<![CDATA[
        protected void fireConstraintDataChanged(
                         int nIdx,
                         Object mcOld,
                         Object mcNew) {
            // Guaranteed to return a non-null array
            Object[] listeners = theMEllListeners.getListenerList();

            ConstraintChangeEvent cce = null;

            // Process the listeners last to first, notifying
            // those that are interested in this event
            for (int i = listeners.length - 2; i >= 0; i -= 2) {
                if (listeners[i] == ConstraintChangeListener.class) {
                    // Lazily create the event:
                    if (cce == null) {
                        cce = new ConstraintChangeEvent(
                            this,
                            nIdx,
                            new CR(mcOld, nIdx),
                            new CR(mcNew, nIdx));
                    }

                    ((ConstraintChangeListener) listeners[i + 1])
                        .constraintDataChanged(cce);
]]>
</codefragment>
</duplication>
</pmd-cpd>